<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="robots" content="none, noindex, nofollow, noarchive, noimageindex, nosnippet" /><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>SQL Overview | notes</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="SQL Overview" />
<meta name="author" content="Nathan Tsai" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Notes on Structured Query Language." />
<meta property="og:description" content="Notes on Structured Query Language." />
<link rel="canonical" href="https://nhtsai.github.io/notes/sql-overview" />
<meta property="og:url" content="https://nhtsai.github.io/notes/sql-overview" />
<meta property="og:site_name" content="notes" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-09-06T00:00:00-05:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="SQL Overview" />
<script type="application/ld+json">
{"url":"https://nhtsai.github.io/notes/sql-overview","@type":"BlogPosting","headline":"SQL Overview","dateModified":"2021-09-06T00:00:00-05:00","datePublished":"2021-09-06T00:00:00-05:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://nhtsai.github.io/notes/sql-overview"},"author":{"@type":"Person","name":"Nathan Tsai"},"description":"Notes on Structured Query Language.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/notes/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://nhtsai.github.io/notes/feed.xml" title="notes" /><link rel="shortcut icon" type="image/x-icon" href="/notes/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <!-- KaTeX -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.20/katex.min.css" integrity="sha512-SgbQw5g+dYpW7CUSasc2ontF/7/JIHORpkzukPxbO2JIcyGy7p2WtlkfBGHvekdhJawrdp+p1bEzBH+nU/cbEg==" crossorigin="anonymous" />
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.20/katex.min.js" integrity="sha512-vhW78Uk043jhhQnaIpK3Io8CbTmcD3fcfZyhl7qz+Md1P78MI7Hlw39lEqdddt8nobv4sclKZU8CeVDzIfLUNA==" crossorigin="anonymous"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.20/contrib/auto-render.min.js" integrity="sha512-ZA/RPrAo88DlwRnnoNVqKINnQNcWERzRK03PDaA4GIJiVZvGFIWQbdWCsUebMZfkWohnfngsDjXzU6PokO4jGw==" crossorigin="anonymous"></script>
    <!-- MathJax -->
    <!-- <script defer src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-chtml.min.js" integrity="sha512-93xLZnNMlYI6xaQPf/cSdXoBZ23DThX7VehiGJJXB76HTTalQKPC5CIHuFX8dlQ5yzt6baBQRJ4sDXhzpojRJA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> -->
    <!-- KaTeX Auto-render Function with custom delimiter rules -->
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/notes/">notes</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/notes/about/">About Me</a><a class="page-link" href="/notes/search/">Search</a><a class="page-link" href="/notes/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">SQL Overview</h1><p class="page-description">Notes on Structured Query Language.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2021-09-06T00:00:00-05:00" itemprop="datePublished">
        Sep 6, 2021
      </time>• 
          <span itemprop="author" itemscope itemtype="http://schema.org/Person">
            <span class="p-author h-card" itemprop="name">Nathan Tsai</span></span>
       • <span class="read-time" title="Estimated read time">
    
    
      28 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/notes/categories/#databases">databases</a>
        &nbsp;
      
        <a class="category-tags-link" href="/notes/categories/#sql">sql</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul id="toc" class="section-nav">
<li class="toc-entry toc-h1"><a href="#sql-overview">SQL Overview</a>
<ul>
<li class="toc-entry toc-h2"><a href="#sql">SQL</a></li>
<li class="toc-entry toc-h2"><a href="#rdbms">RDBMS</a></li>
<li class="toc-entry toc-h2"><a href="#sql-syntax">SQL Syntax</a>
<ul>
<li class="toc-entry toc-h3"><a href="#select">SELECT</a></li>
<li class="toc-entry toc-h3"><a href="#select-toplimit">SELECT TOP/LIMIT</a></li>
<li class="toc-entry toc-h3"><a href="#from">FROM</a></li>
<li class="toc-entry toc-h3"><a href="#where">WHERE</a></li>
<li class="toc-entry toc-h3"><a href="#order-by">ORDER BY</a></li>
<li class="toc-entry toc-h3"><a href="#aggregate-functions">Aggregate Functions</a></li>
<li class="toc-entry toc-h3"><a href="#as-aliasing">AS (Aliasing)</a></li>
<li class="toc-entry toc-h3"><a href="#group-by">GROUP BY</a></li>
<li class="toc-entry toc-h3"><a href="#having">HAVING</a></li>
<li class="toc-entry toc-h3"><a href="#case-when">CASE WHEN</a></li>
<li class="toc-entry toc-h3"><a href="#distinct">DISTINCT</a></li>
<li class="toc-entry toc-h3"><a href="#joins">Joins</a></li>
<li class="toc-entry toc-h3"><a href="#joininner-join">JOIN/INNER JOIN</a></li>
<li class="toc-entry toc-h3"><a href="#left-joinleft-outer-join">LEFT JOIN/LEFT OUTER JOIN</a></li>
<li class="toc-entry toc-h3"><a href="#right-joinright-outer-join">RIGHT JOIN/RIGHT OUTER JOIN</a></li>
<li class="toc-entry toc-h3"><a href="#full-outer-join">FULL OUTER JOIN</a></li>
<li class="toc-entry toc-h3"><a href="#joins-with-conditions">Joins with Conditions</a></li>
<li class="toc-entry toc-h3"><a href="#joins-with-multiple-foreign-keys">Joins with Multiple Foreign Keys</a></li>
<li class="toc-entry toc-h3"><a href="#self-joins">Self Joins</a></li>
<li class="toc-entry toc-h3"><a href="#union">UNION</a></li>
<li class="toc-entry toc-h3"><a href="#data-types">Data Types</a></li>
<li class="toc-entry toc-h3"><a href="#cast">CAST</a></li>
<li class="toc-entry toc-h3"><a href="#dates">Dates</a></li>
<li class="toc-entry toc-h3"><a href="#null-functions">Null Functions</a></li>
<li class="toc-entry toc-h3"><a href="#string-functions">String Functions</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#subqueries">Subqueries</a>
<ul>
<li class="toc-entry toc-h3"><a href="#window-functions">Window Functions</a></li>
<li class="toc-entry toc-h3"><a href="#select-into">SELECT INTO</a></li>
<li class="toc-entry toc-h3"><a href="#update">UPDATE</a></li>
<li class="toc-entry toc-h3"><a href="#delete">DELETE</a></li>
<li class="toc-entry toc-h3"><a href="#insert-into">INSERT INTO</a></li>
<li class="toc-entry toc-h3"><a href="#insert-into-select">INSERT INTO SELECT</a></li>
<li class="toc-entry toc-h3"><a href="#common-table-expressions-cte">Common Table Expressions (CTE)</a></li>
<li class="toc-entry toc-h3"><a href="#stored-procedures">Stored Procedures</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#sql-database">SQL Database</a>
<ul>
<li class="toc-entry toc-h3"><a href="#create-database">CREATE DATABASE</a></li>
<li class="toc-entry toc-h3"><a href="#drop-database">DROP DATABASE</a></li>
<li class="toc-entry toc-h3"><a href="#backup-database">BACKUP DATABASE</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#sql-table">SQL Table</a>
<ul>
<li class="toc-entry toc-h3"><a href="#sql-constraints">SQL Constraints</a></li>
<li class="toc-entry toc-h3"><a href="#sql-index">SQL Index</a></li>
<li class="toc-entry toc-h3"><a href="#views">Views</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#references">References</a></li>
</ul>
</li>
</ul><h1 id="sql-overview">
<a class="anchor" href="#sql-overview" aria-hidden="true"><span class="octicon octicon-link"></span></a>SQL Overview</h1>
<ul>
  <li><a href="https://mode.com/sql-tutorial/">Mode SQL</a></li>
  <li><a href="https://selectstarsql.com/">Select Star SQL</a></li>
  <li><a href="https://www.w3schools.com/sql/default.asp">W3 Schools SQL</a></li>
  <li><a href="https://www.youtube.com/watch?v=Ww71knvhQ-s">Window Functions Video</a></li>
</ul>

<h2 id="sql">
<a class="anchor" href="#sql" aria-hidden="true"><span class="octicon octicon-link"></span></a>SQL</h2>
<ul>
  <li>
<strong>SQL</strong>, or Structured Query Language, is a <a href="https://en.wikipedia.org/wiki/Declarative_programming">declarative language</a> used to access and manipulate databases.</li>
  <li>SQL can execute queries, retrieve data, insert records, update records, and delete records.</li>
  <li>SQL can create new databases, tables, stored procedures, views.</li>
  <li>SQL can set permissions on tables, procedures, and views.</li>
</ul>

<h2 id="rdbms">
<a class="anchor" href="#rdbms" aria-hidden="true"><span class="octicon octicon-link"></span></a>RDBMS</h2>
<ul>
  <li>
<strong>RDBMS</strong>, or Relational Database Management System, is the basis for SQL and all modern database systems (MS SQL Server, MySQL, etc.).</li>
  <li>A <strong>database</strong> is an organized collection of data tables.</li>
  <li>A <strong>schema</strong> is an overview of all tables in a database.</li>
  <li>A <strong>table</strong> is a collection of related data entries, formatted in columns and rows.
    <ul>
      <li>Every table is broken up into smaller entities called <strong>fields</strong>.</li>
      <li>Reference a table using <code class="language-plaintext highlighter-rouge">database.table</code>.</li>
    </ul>
  </li>
  <li>A <strong>field</strong> is a table column (vertical entity) designed to maintain specific information about every record in the table.</li>
  <li>A <strong>record</strong> is a table row (horizontal entity) that holds specific information about each individual entry that exists in a table.</li>
</ul>

<h2 id="sql-syntax">
<a class="anchor" href="#sql-syntax" aria-hidden="true"><span class="octicon octicon-link"></span></a>SQL Syntax</h2>
<ul>
  <li>SQL keywords are not case-sensitive.</li>
  <li>Semicolons separate each SQL statement, often used to execute more than one statement in the same query call.</li>
  <li>Use <code class="language-plaintext highlighter-rouge">-- comment</code> for single line comments, <code class="language-plaintext highlighter-rouge">/* comment */</code> for multi-line comments</li>
</ul>

<h3 id="select">
<a class="anchor" href="#select" aria-hidden="true"><span class="octicon octicon-link"></span></a>SELECT</h3>
<ul>
  <li>Extracts data from a database</li>
  <li>
    <p>Use double-quotes for column names if column name is a keyword.</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Selecting all columns and rows</span>
  <span class="k">SELECT</span> <span class="o">*</span>
  <span class="k">FROM</span> <span class="k">table_name</span>

  <span class="c1">-- Using double quotes for column name (since max is a keyword)</span>
  <span class="k">SELECT</span> <span class="nv">"Max"</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="select-toplimit">
<a class="anchor" href="#select-toplimit" aria-hidden="true"><span class="octicon octicon-link"></span></a>SELECT TOP/LIMIT</h3>
<ul>
  <li>Specify the number of records to return</li>
  <li>
    <p>Use <code class="language-plaintext highlighter-rouge">LIMIT</code> for MySQL, other databases have different ones</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- SQL Server/MS Access</span>
  <span class="k">SELECT</span> <span class="n">TOP</span> <span class="mi">10</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span>
  <span class="k">FROM</span> <span class="k">table_name</span>

  <span class="c1">-- MySQL/PostgreSQL</span>
  <span class="k">SELECT</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
  <span class="k">LIMIT</span> <span class="mi">10</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">col1</span> <span class="k">DESC</span> <span class="c1">-- use ORDER BY to get meaningful row order</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="from">
<a class="anchor" href="#from" aria-hidden="true"><span class="octicon octicon-link"></span></a>FROM</h3>
<ul>
  <li>
    <p>Denotes the database and table to query</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Selecting all rows of col1</span>
  <span class="k">SELECT</span> <span class="n">col1</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="where">
<a class="anchor" href="#where" aria-hidden="true"><span class="octicon octicon-link"></span></a>WHERE</h3>
<ul>
  <li>
    <p>Filters the data retrieved from the database based on a specified condition</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Filtering for rows where col1 is positive</span>
  <span class="k">SELECT</span> <span class="n">col1</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
  <span class="k">WHERE</span> <span class="n">col1</span> <span class="o">&gt;</span> <span class="mi">0</span>
</code></pre></div>    </div>
  </li>
</ul>

<table>
  <thead>
    <tr>
      <th>Comparison Operators</th>
      <th>Symbol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Equal To</td>
      <td>=</td>
    </tr>
    <tr>
      <td>Not Equal To</td>
      <td>&lt;&gt;, !=</td>
    </tr>
    <tr>
      <td>Greater Than</td>
      <td>&gt;</td>
    </tr>
    <tr>
      <td>Greater Than or Equal To</td>
      <td>&gt;=</td>
    </tr>
    <tr>
      <td>Less Than</td>
      <td>&lt;</td>
    </tr>
    <tr>
      <td>Less Than or Equal To</td>
      <td>&lt;=</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th>Arithmetic Operators</th>
      <th>Symbol</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Addition</td>
      <td>+</td>
    </tr>
    <tr>
      <td>Subtraction</td>
      <td>-</td>
    </tr>
    <tr>
      <td>Multiplication</td>
      <td>*</td>
    </tr>
    <tr>
      <td>Division</td>
      <td>/</td>
    </tr>
  </tbody>
</table>

<ul>
  <li>Use operators to compare across columns in the same row.
    <ul>
      <li>Need aggregate functions to compare across rows.</li>
    </ul>
  </li>
</ul>

<table>
  <thead>
    <tr>
      <th>Logical Operators</th>
      <th>Symbol</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Match similar values</td>
      <td>
<code class="language-plaintext highlighter-rouge">LIKE</code>, <br> <code class="language-plaintext highlighter-rouge">%</code> is a multiple wildcard character, <br> <code class="language-plaintext highlighter-rouge">_</code> is an individual wildcard character, <br> <code class="language-plaintext highlighter-rouge">[ab]</code> is any single character, <br> <code class="language-plaintext highlighter-rouge">[^ab]</code> is any single character not in brackets, <br> <code class="language-plaintext highlighter-rouge">[a-b]</code> is any single character in a range of characters</td>
      <td><code class="language-plaintext highlighter-rouge">WHERE col LIKE 'n%'</code></td>
    </tr>
    <tr>
      <td>Match similar values, case insensitive</td>
      <td><code class="language-plaintext highlighter-rouge">ILIKE</code></td>
      <td><code class="language-plaintext highlighter-rouge">WHERE col LIKE 'n%'</code></td>
    </tr>
    <tr>
      <td>Match on list of values, or query result</td>
      <td><code class="language-plaintext highlighter-rouge">IN</code></td>
      <td><code class="language-plaintext highlighter-rouge">WHERE col IN (1, 2, 3)</code></td>
    </tr>
    <tr>
      <td>Match on a range, inclusive</td>
      <td><code class="language-plaintext highlighter-rouge">BETWEEN ... AND ...</code></td>
      <td><code class="language-plaintext highlighter-rouge">WHERE col BETWEEN 5 AND 10</code></td>
    </tr>
    <tr>
      <td>Match null values</td>
      <td><code class="language-plaintext highlighter-rouge">IS NULL</code></td>
      <td><code class="language-plaintext highlighter-rouge">WHERE col IS NULL</code></td>
    </tr>
    <tr>
      <td>Match non-null values</td>
      <td><code class="language-plaintext highlighter-rouge">IS NOT NULL</code></td>
      <td><code class="language-plaintext highlighter-rouge">WHERE col IS NOT NULL</code></td>
    </tr>
    <tr>
      <td>Match on 2 conditions</td>
      <td><code class="language-plaintext highlighter-rouge">AND</code></td>
      <td><code class="language-plaintext highlighter-rouge">WHERE col &gt;= 1 AND col &lt;= 2</code></td>
    </tr>
    <tr>
      <td>Match on either of 2 conditions</td>
      <td><code class="language-plaintext highlighter-rouge">OR</code></td>
      <td><code class="language-plaintext highlighter-rouge">WHERE col = 1 OR (col = 2 AND col = 3)</code></td>
    </tr>
    <tr>
      <td>Match on not a condition</td>
      <td><code class="language-plaintext highlighter-rouge">NOT</code></td>
      <td>
<code class="language-plaintext highlighter-rouge">WHERE col NOT LIKE '%n%'</code> <br> <code class="language-plaintext highlighter-rouge">WHERE col NOT BETWEEN 2 AND 3</code>
</td>
    </tr>
    <tr>
      <td>Match on any values meeting condition</td>
      <td><code class="language-plaintext highlighter-rouge">ANY</code></td>
      <td><code class="language-plaintext highlighter-rouge">WHERE id = ANY(SELECT id FROM users WHERE score = 10)</code></td>
    </tr>
    <tr>
      <td>Match on all values meeting condition</td>
      <td><code class="language-plaintext highlighter-rouge">ALL</code></td>
      <td><code class="language-plaintext highlighter-rouge">WHERE id != ALL(SELECT id FROM users WHERE score &lt; 90)</code></td>
    </tr>
    <tr>
      <td>Exists if subquery returns 1+ rows</td>
      <td><code class="language-plaintext highlighter-rouge">EXISTS</code></td>
      <td><code class="language-plaintext highlighter-rouge">WHERE EXISTS (SELECT id FROM users WHERE age &lt; 18)</code></td>
    </tr>
  </tbody>
</table>

<h3 id="order-by">
<a class="anchor" href="#order-by" aria-hidden="true"><span class="octicon octicon-link"></span></a>ORDER BY</h3>
<ul>
  <li>Sorts data based on 1+ columns</li>
  <li>Ascending sort by default, use <code class="language-plaintext highlighter-rouge">DESC</code> for descending sort</li>
  <li>
    <p>Can also use #s in place of column names, corresponding to (1-indexed) order of columns in <code class="language-plaintext highlighter-rouge">SELECT</code></p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Ordering using column names</span>
  <span class="k">SELECT</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">col1</span> <span class="k">DESC</span><span class="p">,</span> <span class="n">col2</span>

  <span class="c1">-- Ordering using column numbers</span>
  <span class="k">SELECT</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">1</span> <span class="k">DESC</span><span class="p">,</span> <span class="mi">2</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="aggregate-functions">
<a class="anchor" href="#aggregate-functions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Aggregate Functions</h3>

<table>
  <thead>
    <tr>
      <th>Aggregation</th>
      <th>Command</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Gets count of all non-null values</td>
      <td><code class="language-plaintext highlighter-rouge">COUNT</code></td>
      <td><code class="language-plaintext highlighter-rouge">SELECT COUNT(col1)</code></td>
    </tr>
    <tr>
      <td>Gets sum of all values, null values are 0</td>
      <td><code class="language-plaintext highlighter-rouge">SUM</code></td>
      <td><code class="language-plaintext highlighter-rouge">SELECT SUM(col1)</code></td>
    </tr>
    <tr>
      <td>Gets average of all values, null values are 0</td>
      <td><code class="language-plaintext highlighter-rouge">AVG</code></td>
      <td><code class="language-plaintext highlighter-rouge">SELECT AVG(col1)</code></td>
    </tr>
    <tr>
      <td>Gets minimum of all values</td>
      <td><code class="language-plaintext highlighter-rouge">MIN</code></td>
      <td><code class="language-plaintext highlighter-rouge">SELECT MIN(col1)</code></td>
    </tr>
    <tr>
      <td>Gets maximum of all values</td>
      <td><code class="language-plaintext highlighter-rouge">MAX</code></td>
      <td><code class="language-plaintext highlighter-rouge">SELECT MAX(col1)</code></td>
    </tr>
  </tbody>
</table>

<h3 id="as-aliasing">
<a class="anchor" href="#as-aliasing" aria-hidden="true"><span class="octicon octicon-link"></span></a>AS (Aliasing)</h3>
<ul>
  <li>
    <p>Renames a table or column</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="n">col1</span> <span class="k">AS</span> <span class="nv">"Sales"</span>
  <span class="k">FROM</span> <span class="k">table_name</span> <span class="k">AS</span> <span class="n">T</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="group-by">
<a class="anchor" href="#group-by" aria-hidden="true"><span class="octicon octicon-link"></span></a>GROUP BY</h3>
<ul>
  <li>Aggregates across smaller groupings instead of the whole table</li>
  <li>Required for non-aggregated columns when performing aggregation</li>
  <li>Can also reference columns by 1-indexed order in <code class="language-plaintext highlighter-rouge">SELECT</code>
</li>
  <li>
    <p>Order of column names in grouping does not matter</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">C</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
  <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span>

  <span class="c1">-- Equivalent query</span>
  <span class="k">SELECT</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">C</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
  <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="having">
<a class="anchor" href="#having" aria-hidden="true"><span class="octicon octicon-link"></span></a>HAVING</h3>
<ul>
  <li>Filters the result of aggregate columns</li>
  <li>
    <p>Like <code class="language-plaintext highlighter-rouge">WHERE</code> but for aggregated columns</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="n">A</span><span class="p">,</span> <span class="k">MAX</span><span class="p">(</span><span class="n">B</span><span class="p">)</span>    <span class="c1">-- max aggregation</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
  <span class="k">WHERE</span> <span class="n">A</span> <span class="o">&gt;=</span> <span class="mi">4</span>        <span class="c1">-- filter before aggregation</span>
  <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">A</span>          <span class="c1">-- group by non-aggregated cols</span>
  <span class="k">HAVING</span> <span class="k">MAX</span><span class="p">(</span><span class="n">B</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span>  <span class="c1">-- filter after aggregation</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="mi">2</span> <span class="k">DESC</span>     <span class="c1">-- descending sort by MAX(B)</span>
  <span class="k">LIMIT</span> <span class="mi">100</span>           <span class="c1">-- return only first 100 rows</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="case-when">
<a class="anchor" href="#case-when" aria-hidden="true"><span class="octicon octicon-link"></span></a>CASE WHEN</h3>
<ul>
  <li>Used to handle if/else logic</li>
  <li>Always goes in the <code class="language-plaintext highlighter-rouge">SELECT</code> clause</li>
  <li>
    <p>Default value is <code class="language-plaintext highlighter-rouge">NULL</code> if no <code class="language-plaintext highlighter-rouge">ELSE</code> clause</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="k">CASE</span>
          <span class="k">WHEN</span> <span class="n">condition</span> <span class="k">THEN</span> <span class="n">value</span>
          <span class="k">WHEN</span> <span class="n">condition</span> <span class="k">THEN</span> <span class="n">value</span>
          <span class="k">ELSE</span> <span class="n">value</span> <span class="c1">-- optional, default is NULL</span>
      <span class="k">END</span> <span class="k">AS</span> <span class="n">col_name</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
</code></pre></div>    </div>
  </li>
  <li>Use with aggregate functions to create different aggregation groups
    <ul>
      <li>can use <code class="language-plaintext highlighter-rouge">CASE WHEN</code> alias in <code class="language-plaintext highlighter-rouge">GROUP BY</code> or copy and paste the whole <code class="language-plaintext highlighter-rouge">CASE WHEN</code>
</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- vertical table example</span>
  <span class="k">SELECT</span> <span class="k">CASE</span> <span class="c1">-- processes all c values into 5 groups</span>
          <span class="k">WHEN</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span> <span class="k">THEN</span> <span class="s1">'Freshman'</span>
          <span class="k">WHEN</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span> <span class="k">THEN</span> <span class="s1">'Sophomore'</span>
          <span class="k">WHEN</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span> <span class="k">THEN</span> <span class="s1">'Junior'</span>
          <span class="k">WHEN</span> <span class="n">col</span><span class="o">=</span><span class="mi">4</span> <span class="k">THEN</span> <span class="s1">'Senior'</span>
      <span class="k">ELSE</span> <span class="s1">'None'</span>
      <span class="k">END</span> <span class="k">AS</span> <span class="n">grade</span><span class="p">,</span>
      <span class="k">COUNT</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">AS</span> <span class="k">count</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
  <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">grade</span>  <span class="c1">-- groups by grade</span>

  <span class="c1">-- horizontal table example</span>
  <span class="k">SELECT</span> 
      <span class="k">COUNT</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">col</span><span class="o">=</span><span class="mi">1</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="n">fr_count</span><span class="p">,</span>
      <span class="k">COUNT</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">col</span><span class="o">=</span><span class="mi">2</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="n">so_count</span><span class="p">,</span>
      <span class="k">COUNT</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">col</span><span class="o">=</span><span class="mi">3</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="n">jr_count</span><span class="p">,</span>
      <span class="k">COUNT</span><span class="p">(</span><span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">col</span><span class="o">=</span><span class="mi">4</span> <span class="k">THEN</span> <span class="mi">1</span> <span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span><span class="p">)</span> <span class="k">AS</span> <span class="n">sr_count</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="distinct">
<a class="anchor" href="#distinct" aria-hidden="true"><span class="octicon octicon-link"></span></a>DISTINCT</h3>
<ul>
  <li>Selects unique values of 1+ columns</li>
  <li>Only need to include <code class="language-plaintext highlighter-rouge">DISTINCT</code> once</li>
  <li>
    <p>Slow performance, especially in aggregations</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="nb">year</span><span class="p">,</span> <span class="k">month</span>
  <span class="k">FROM</span> <span class="k">table_name</span>

  <span class="c1">-- use with aggregate</span>
  <span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="k">month</span><span class="p">)</span> <span class="k">AS</span> <span class="n">unique_months</span>
  <span class="k">FROM</span> <span class="k">table</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="joins">
<a class="anchor" href="#joins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Joins</h3>
<ul>
  <li>Uses common identifiers to join related tables
    <ul>
      <li>Rows without matching common identifiers will default to <code class="language-plaintext highlighter-rouge">NULL</code>
</li>
    </ul>
  </li>
  <li>Use aliases for tables when joining
    <ul>
      <li>Aliases distinguish identical column names when joining two tables</li>
    </ul>
  </li>
  <li>Can use aliases in <code class="language-plaintext highlighter-rouge">SELECT</code> clause, like <code class="language-plaintext highlighter-rouge">SELECT alias.col_name</code>
</li>
</ul>

<h3 id="joininner-join">
<a class="anchor" href="#joininner-join" aria-hidden="true"><span class="octicon octicon-link"></span></a>JOIN/INNER JOIN</h3>
<ul>
  <li>Joins two tables, returns only matched rows from both tables</li>
  <li>
    <p>Unmatched rows are not included</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Keeps matched rows</span>
  <span class="k">SELECT</span> <span class="n">A</span><span class="p">.</span><span class="o">*</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">col2</span>
  <span class="k">FROM</span> <span class="n">table1</span> <span class="n">A</span>
  <span class="k">JOIN</span> <span class="n">table2</span> <span class="n">B</span> 
  <span class="k">ON</span> <span class="n">A</span><span class="p">.</span><span class="n">col</span><span class="o">=</span><span class="n">B</span><span class="p">.</span><span class="n">col</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="left-joinleft-outer-join">
<a class="anchor" href="#left-joinleft-outer-join" aria-hidden="true"><span class="octicon octicon-link"></span></a>LEFT JOIN/LEFT OUTER JOIN</h3>
<ul>
  <li>
    <p>Joins two tables, returns matched rows and unmatched rows from left table.</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Keeps all A rows and matched B rows</span>
  <span class="k">SELECT</span> <span class="n">A</span><span class="p">.</span><span class="o">*</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">col2</span>
  <span class="k">FROM</span> <span class="n">table1</span> <span class="n">A</span>
  <span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">table2</span> <span class="n">B</span> 
  <span class="k">ON</span> <span class="n">A</span><span class="p">.</span><span class="n">col</span><span class="o">=</span><span class="n">B</span><span class="p">.</span><span class="n">col</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="right-joinright-outer-join">
<a class="anchor" href="#right-joinright-outer-join" aria-hidden="true"><span class="octicon octicon-link"></span></a>RIGHT JOIN/RIGHT OUTER JOIN</h3>
<ul>
  <li>Joins two tables, returns matched rows and unmatched rows from right table.</li>
  <li>
    <p>Usually use flip the table order and use <code class="language-plaintext highlighter-rouge">LEFT JOIN</code>.</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Keeps match A rows and all B rows</span>
  <span class="k">SELECT</span> <span class="n">A</span><span class="p">.</span><span class="o">*</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">col2</span>
  <span class="k">FROM</span> <span class="n">table1</span> <span class="n">A</span>
  <span class="k">RIGHT</span> <span class="k">JOIN</span> <span class="n">table2</span> <span class="n">B</span> 
  <span class="k">ON</span> <span class="n">A</span><span class="p">.</span><span class="n">col</span><span class="o">=</span><span class="n">B</span><span class="p">.</span><span class="n">col</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="full-outer-join">
<a class="anchor" href="#full-outer-join" aria-hidden="true"><span class="octicon octicon-link"></span></a>FULL OUTER JOIN</h3>
<ul>
  <li>Joins two tables, returns all matched and unmatched rows.</li>
  <li>
    <p>Commonly used in aggregations to find overlap between two tables</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Keeps all matched/unmatched rows</span>
  <span class="k">SELECT</span> <span class="n">A</span><span class="p">.</span><span class="o">*</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">col2</span>
  <span class="k">FROM</span> <span class="n">table1</span> <span class="n">A</span>
  <span class="k">JOIN</span> <span class="n">table2</span> <span class="n">B</span> 
  <span class="k">ON</span> <span class="n">A</span><span class="p">.</span><span class="n">col</span><span class="o">=</span><span class="n">B</span><span class="p">.</span><span class="n">col</span>

  <span class="c1">-- Example</span>
  <span class="k">SELECT</span>
      <span class="k">COUNT</span><span class="p">(</span>
          <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">A</span><span class="p">.</span><span class="n">a</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">AND</span> <span class="n">B</span><span class="p">.</span><span class="n">b</span> <span class="k">IS</span> <span class="k">NULL</span>
          <span class="k">THEN</span> <span class="n">A</span><span class="p">.</span><span class="n">a</span> <span class="c1">-- must use A.a otherwise NULL and COUNT will be 0</span>
          <span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span>
      <span class="p">)</span> <span class="k">AS</span> <span class="n">A_only</span><span class="p">,</span>
      <span class="k">COUNT</span><span class="p">(</span>
          <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">A</span><span class="p">.</span><span class="n">a</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">AND</span> <span class="n">B</span><span class="p">.</span><span class="n">b</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>
          <span class="k">THEN</span> <span class="n">A</span><span class="p">.</span><span class="n">a</span> <span class="c1">-- can keep either A.a or B.b</span>
          <span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span>
      <span class="p">)</span> <span class="k">AS</span> <span class="k">both</span><span class="p">,</span>
      <span class="k">COUNT</span><span class="p">(</span>
          <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">A</span><span class="p">.</span><span class="n">a</span> <span class="k">IS</span> <span class="k">NULL</span> <span class="k">AND</span> <span class="n">B</span><span class="p">.</span><span class="n">b</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>
          <span class="k">THEN</span> <span class="n">B</span><span class="p">.</span><span class="n">b</span> <span class="c1">-- must use B.b otherwise NULL and COUNT will be 0</span>
          <span class="k">ELSE</span> <span class="k">NULL</span> <span class="k">END</span>
      <span class="p">)</span> <span class="k">AS</span> <span class="n">B_only</span>
  <span class="k">FROM</span> <span class="n">table1</span> <span class="n">A</span>
  <span class="k">JOIN</span> <span class="n">table2</span> <span class="n">B</span>
  <span class="k">ON</span> <span class="n">A</span><span class="p">.</span><span class="n">a</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="n">b</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="joins-with-conditions">
<a class="anchor" href="#joins-with-conditions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Joins with Conditions</h3>
<ul>
  <li>
    <p>Can put conditions either in the <code class="language-plaintext highlighter-rouge">WHERE</code> or <code class="language-plaintext highlighter-rouge">ON</code> clauses</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Finds rows that fit the condition rather</span>
  <span class="c1">-- than joining all rows then filtering</span>
  <span class="k">SELECT</span> <span class="n">A</span><span class="p">.</span><span class="o">*</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="o">*</span>
  <span class="k">FROM</span> <span class="n">table1</span> <span class="n">A</span>
  <span class="k">JOIN</span> <span class="n">table2</span> <span class="n">B</span>
  <span class="k">ON</span> <span class="n">A</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="n">id</span>
  <span class="k">AND</span> <span class="n">A</span><span class="p">.</span><span class="nb">year</span> <span class="o">&gt;</span> <span class="n">B</span><span class="p">.</span><span class="nb">year</span> <span class="o">+</span> <span class="mi">5</span>
</code></pre></div>    </div>
  </li>
  <li>Conditioning <code class="language-plaintext highlighter-rouge">WHERE</code> vs. <code class="language-plaintext highlighter-rouge">ON</code> clauses
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">WHERE</code> joins all rows that match, then filters the rows based on that condition
        <ul>
          <li>May be less efficient when joining large tables</li>
        </ul>
      </li>
      <li>
<code class="language-plaintext highlighter-rouge">ON</code> only joins rows that match the conditions listed</li>
      <li>For <code class="language-plaintext highlighter-rouge">INNER JOIN</code>s, the two methods effectively produce the <em>same results</em> because unmatched (NULL) rows are discarded.</li>
      <li>For <code class="language-plaintext highlighter-rouge">OUTER JOIN</code>s, this is a slight difference.</li>
    </ul>
  </li>
  <li>Example
    <ul>
      <li>documents table</li>
    </ul>

    <table>
      <thead>
        <tr>
          <th>id</th>
          <th>name</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>doc1</td>
        </tr>
        <tr>
          <td>2</td>
          <td>doc2</td>
        </tr>
        <tr>
          <td>3</td>
          <td>doc3</td>
        </tr>
        <tr>
          <td>4</td>
          <td>doc4</td>
        </tr>
        <tr>
          <td>5</td>
          <td>doc5</td>
        </tr>
      </tbody>
    </table>

    <ul>
      <li>downloads table</li>
    </ul>

    <table>
      <thead>
        <tr>
          <th>id</th>
          <th>doc_id</th>
          <th>user</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>1</td>
          <td>sandeep</td>
        </tr>
        <tr>
          <td>2</td>
          <td>1</td>
          <td>simi</td>
        </tr>
        <tr>
          <td>3</td>
          <td>2</td>
          <td>sandeep</td>
        </tr>
        <tr>
          <td>4</td>
          <td>2</td>
          <td>reya</td>
        </tr>
        <tr>
          <td>5</td>
          <td>3</td>
          <td>simi</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">WHERE</code> conditioning vs. <code class="language-plaintext highlighter-rouge">ON</code> conditioning</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="n">documents</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">downloads</span><span class="p">.</span><span class="n">id</span>
  <span class="k">FROM</span> <span class="n">documents</span>
  <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">downloads</span>
  <span class="k">ON</span> <span class="n">documents</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="n">downloads</span><span class="p">.</span><span class="n">doc_id</span>
  <span class="k">WHERE</span> <span class="k">user</span><span class="o">=</span><span class="s1">'sandeep'</span>            <span class="c1">-- WHERE condition</span>

  <span class="k">SELECT</span> <span class="n">documents</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">downloads</span><span class="p">.</span><span class="n">id</span>
  <span class="k">FROM</span> <span class="n">documents</span>
  <span class="k">LEFT</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">downloads</span>
  <span class="k">ON</span> <span class="n">documents</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="n">downloads</span><span class="p">.</span><span class="n">doc_id</span>
  <span class="k">AND</span> <span class="k">user</span><span class="o">=</span><span class="s1">'sandeep'</span>              <span class="c1">-- ON condition</span>
</code></pre></div>    </div>
  </li>
  <li>Intermediate <code class="language-plaintext highlighter-rouge">JOIN</code> table for <code class="language-plaintext highlighter-rouge">WHERE</code> conditioning
    <ul>
      <li>Matches every row using key, filters <strong>after the join</strong>.</li>
    </ul>

    <table>
      <thead>
        <tr>
          <th>documents.id</th>
          <th>name</th>
          <th>downloads.id</th>
          <th>doc_id</th>
          <th>user</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>doc1</td>
          <td>1</td>
          <td>1</td>
          <td>sandeep</td>
        </tr>
        <tr>
          <td>1</td>
          <td>doc1</td>
          <td>2</td>
          <td>1</td>
          <td>simi</td>
        </tr>
        <tr>
          <td>2</td>
          <td>doc2</td>
          <td>3</td>
          <td>2</td>
          <td>sandeep</td>
        </tr>
        <tr>
          <td>2</td>
          <td>doc2</td>
          <td>4</td>
          <td>2</td>
          <td>reya</td>
        </tr>
        <tr>
          <td>3</td>
          <td>doc3</td>
          <td>5</td>
          <td>3</td>
          <td>simi</td>
        </tr>
        <tr>
          <td>4</td>
          <td>doc4</td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
        </tr>
        <tr>
          <td>5</td>
          <td>doc5</td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>Intermediate <code class="language-plaintext highlighter-rouge">JOIN</code> table for <code class="language-plaintext highlighter-rouge">ON</code> conditioning
    <ul>
      <li>Does not match rows that are not <code class="language-plaintext highlighter-rouge">user='sandeep'</code>, filters one table <strong>before the join</strong>.</li>
    </ul>

    <table>
      <thead>
        <tr>
          <th>documents.id</th>
          <th>name</th>
          <th>downloads.id</th>
          <th>doc_id</th>
          <th>user</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>doc1</td>
          <td>1</td>
          <td>1</td>
          <td>sandeep</td>
        </tr>
        <tr>
          <td>2</td>
          <td>doc2</td>
          <td>3</td>
          <td>2</td>
          <td>sandeep</td>
        </tr>
        <tr>
          <td>3</td>
          <td>doc3</td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
        </tr>
        <tr>
          <td>4</td>
          <td>doc4</td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
        </tr>
        <tr>
          <td>5</td>
          <td>doc5</td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Result of <code class="language-plaintext highlighter-rouge">WHERE</code> conditioning</p>

    <table>
      <thead>
        <tr>
          <th>name</th>
          <th>downloads.id</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>doc1</td>
          <td>1</td>
        </tr>
        <tr>
          <td>doc2</td>
          <td>3</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>
    <p>Result of <code class="language-plaintext highlighter-rouge">ON</code> conditioning</p>

    <table>
      <thead>
        <tr>
          <th>name</th>
          <th>downloads.id</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>doc1</td>
          <td>1</td>
        </tr>
        <tr>
          <td>doc2</td>
          <td>3</td>
        </tr>
        <tr>
          <td>doc3</td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
        </tr>
        <tr>
          <td>doc3</td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
        </tr>
        <tr>
          <td>doc4</td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
        </tr>
        <tr>
          <td>doc5</td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>Because the <code class="language-plaintext highlighter-rouge">WHERE</code> condition filters after the <code class="language-plaintext highlighter-rouge">LEFT OUTER JOIN</code>, THE <code class="language-plaintext highlighter-rouge">NULL</code> rows of the <code class="language-plaintext highlighter-rouge">user</code> column are removed. You can see that because the <code class="language-plaintext highlighter-rouge">ON</code> condition filters before the <code class="language-plaintext highlighter-rouge">LEFT OUTER JOIN</code>, the <code class="language-plaintext highlighter-rouge">NULL</code> rows are kept in the final result.</li>
  <li>For <code class="language-plaintext highlighter-rouge">INNER JOIN</code>s, put join conditions in the <code class="language-plaintext highlighter-rouge">ON</code> clause and put where conditions in the <code class="language-plaintext highlighter-rouge">WHERE</code> clause.</li>
  <li>For <code class="language-plaintext highlighter-rouge">LEFT OUTER JOIN</code>s, put join conditions in the <code class="language-plaintext highlighter-rouge">ON</code> clause and put <em>where conditions that reference the right table</em> in the <code class="language-plaintext highlighter-rouge">ON</code> clause also.
    <ul>
      <li>Referencing the <em>right table</em> after the <code class="language-plaintext highlighter-rouge">LEFT JOIN</code> in the <code class="language-plaintext highlighter-rouge">WHERE</code> clause converts the <code class="language-plaintext highlighter-rouge">LEFT JOIN</code> into an <code class="language-plaintext highlighter-rouge">INNER JOIN</code>.</li>
      <li>Exception: reference the <em>right table</em> in the <code class="language-plaintext highlighter-rouge">WHERE</code> clause when looking for records not in the table, e.g. <code class="language-plaintext highlighter-rouge">WHERE t2.id IS NULL</code>.</li>
      <li>Think of conditions in the <code class="language-plaintext highlighter-rouge">ON</code> clause as “right table <code class="language-plaintext highlighter-rouge">WHERE</code> clause filters” that are applied <em>prior to joining</em>.</li>
    </ul>
  </li>
</ul>

<h3 id="joins-with-multiple-foreign-keys">
<a class="anchor" href="#joins-with-multiple-foreign-keys" aria-hidden="true"><span class="octicon octicon-link"></span></a>Joins with Multiple Foreign Keys</h3>
<ul>
  <li>Accuracy of joining is improved</li>
  <li>Performances: SQL uses indexes to speed up queries
    <ul>
      <li>Using multiple join keys can speed up performance for large datasets</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="n">A</span><span class="p">.</span><span class="n">col1</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">col1</span>
  <span class="k">FROM</span> <span class="n">table1</span> <span class="n">A</span>
  <span class="k">JOIN</span> <span class="n">table2</span> <span class="n">B</span>
  <span class="k">ON</span> <span class="n">A</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="n">id</span> <span class="k">AND</span> <span class="n">A</span><span class="p">.</span><span class="n">col</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="n">col</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="self-joins">
<a class="anchor" href="#self-joins" aria-hidden="true"><span class="octicon octicon-link"></span></a>Self Joins</h3>
<ul>
  <li>Joins a table with itself</li>
  <li>
    <p>Self joins can help compare different records of the same table</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- WHERE: Find pairs from the same city</span>
  <span class="k">SELECT</span> <span class="n">A</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">A</span><span class="p">.</span><span class="n">city</span>
  <span class="k">FROM</span> <span class="n">users</span> <span class="n">A</span><span class="p">,</span> <span class="n">users</span> <span class="n">B</span>
  <span class="k">WHERE</span> <span class="n">A</span><span class="p">.</span><span class="n">id</span> <span class="o">&lt;&gt;</span> <span class="n">B</span><span class="p">.</span><span class="n">id</span>      <span class="c1">-- avoid matching users to themselves</span>
  <span class="k">AND</span> <span class="n">A</span><span class="p">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="n">city</span>     <span class="c1">-- find pairs from the same city</span>

  <span class="c1">-- ON: Find all pairs</span>
  <span class="k">SELECT</span> <span class="n">A</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">name</span>
  <span class="k">FROM</span> <span class="n">table1</span> <span class="n">A</span>
  <span class="k">JOIN</span> <span class="n">table1</span> <span class="n">B</span>
  <span class="k">ON</span> <span class="n">A</span><span class="p">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">B</span><span class="p">.</span><span class="n">id</span> <span class="c1">-- prevents identical pairs, e.g. (5, 5)</span>

  <span class="c1">-- ON: Find all unique pairs</span>
  <span class="k">SELECT</span> <span class="n">A</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">name</span>
  <span class="k">FROM</span> <span class="n">table1</span> <span class="n">A</span>
  <span class="k">JOIN</span> <span class="n">table1</span> <span class="n">B</span>
  <span class="k">ON</span> <span class="n">A</span><span class="p">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="n">B</span><span class="p">.</span><span class="n">id</span> <span class="c1">-- prevents identical pairs and permutations, e.g. (1, 5) but not (5, 1)</span>

  <span class="c1">-- ON: Find unique pairs of duplicates</span>
  <span class="k">SELECT</span> <span class="n">A</span><span class="p">.</span><span class="n">name</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="n">name</span>
  <span class="k">FROM</span> <span class="n">table1</span> <span class="n">A</span>
  <span class="k">JOIN</span> <span class="n">table1</span> <span class="n">B</span>
  <span class="k">ON</span> <span class="n">A</span><span class="p">.</span><span class="n">id</span> <span class="o">&lt;</span> <span class="n">B</span><span class="p">.</span><span class="n">id</span>      <span class="c1">-- gets different pairs</span>
  <span class="k">AND</span> <span class="n">A</span><span class="p">.</span><span class="k">last</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="k">last</span> <span class="c1">-- with the same value, eg. different people with same last name</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="union">
<a class="anchor" href="#union" aria-hidden="true"><span class="octicon octicon-link"></span></a>UNION</h3>
<ul>
  <li>Stacks two tables vertically</li>
  <li>Only appends <code class="language-plaintext highlighter-rouge">DISTINCT</code> values, identical rows are dropped</li>
  <li>Use <code class="language-plaintext highlighter-rouge">UNION ALL</code> to append all values, including identical rows</li>
  <li>Can write 2 <code class="language-plaintext highlighter-rouge">SELECT</code> queries, and put the results on top of each other to create one table
    <ul>
      <li>Result set’s column names usually same as first <code class="language-plaintext highlighter-rouge">SELECT</code> clause</li>
    </ul>
  </li>
  <li>Every <code class="language-plaintext highlighter-rouge">SELECT</code> statement within <code class="language-plaintext highlighter-rouge">UNION</code> must have same number of columns
    <ul>
      <li>The columns must have similar data types</li>
      <li>The columns in every <code class="language-plaintext highlighter-rouge">SELECT</code> statement must also be in the same order</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- UNION Example</span>
  <span class="k">SELECT</span> <span class="n">City</span><span class="p">,</span> <span class="n">Country</span> <span class="k">FROM</span> <span class="n">Customers</span>
  <span class="k">WHERE</span> <span class="n">Country</span><span class="o">=</span><span class="s1">'Germany'</span>
  <span class="k">UNION</span>
  <span class="k">SELECT</span> <span class="n">City</span><span class="p">,</span> <span class="n">Country</span> <span class="k">FROM</span> <span class="n">Suppliers</span>
  <span class="k">WHERE</span> <span class="n">Country</span><span class="o">=</span><span class="s1">'Germany'</span>

  <span class="c1">-- Union Example</span>
  <span class="k">SELECT</span> <span class="s1">'Customer'</span> <span class="k">AS</span> <span class="k">Type</span><span class="p">,</span> <span class="n">ContactName</span><span class="p">,</span> <span class="n">City</span><span class="p">,</span> <span class="n">Country</span>
  <span class="k">FROM</span> <span class="n">Customers</span>
  <span class="k">UNION</span>
  <span class="k">SELECT</span> <span class="s1">'Supplier'</span><span class="p">,</span> <span class="n">ContactName</span><span class="p">,</span> <span class="n">City</span><span class="p">,</span> <span class="n">Country</span>
  <span class="k">FROM</span> <span class="n">Suppliers</span><span class="p">;</span>

  <span class="c1">-- UNION ALL Example</span>
  <span class="k">SELECT</span> <span class="n">City</span><span class="p">,</span> <span class="n">Country</span> <span class="k">FROM</span> <span class="n">Customers</span>
  <span class="k">WHERE</span> <span class="n">Country</span><span class="o">=</span><span class="s1">'Germany'</span>
  <span class="k">UNION</span>
  <span class="k">SELECT</span> <span class="n">City</span><span class="p">,</span> <span class="n">Country</span> <span class="k">FROM</span> <span class="n">Suppliers</span>
  <span class="k">WHERE</span> <span class="n">Country</span><span class="o">=</span><span class="s1">'Germany'</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">City</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="data-types">
<a class="anchor" href="#data-types" aria-hidden="true"><span class="octicon octicon-link"></span></a>Data Types</h3>
<ul>
  <li>Differences vary across various versions of SQL</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Imported As</th>
      <th>Stored As</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>String</td>
      <td><code class="language-plaintext highlighter-rouge">VARCHAR(1024)</code></td>
    </tr>
    <tr>
      <td>Date/Time</td>
      <td>
<code class="language-plaintext highlighter-rouge">DATE</code>, <code class="language-plaintext highlighter-rouge">DATETIME</code>, <code class="language-plaintext highlighter-rouge">TIMESTAMP</code>, <code class="language-plaintext highlighter-rouge">INTERVAL</code>, <code class="language-plaintext highlighter-rouge">YEAR</code>
</td>
    </tr>
    <tr>
      <td>Number</td>
      <td>Exact: <code class="language-plaintext highlighter-rouge">INTEGER</code>, <code class="language-plaintext highlighter-rouge">SMALLINT</code>, <code class="language-plaintext highlighter-rouge">DECIMAL</code>, <code class="language-plaintext highlighter-rouge">NUMERIC</code> <br> Approx: <code class="language-plaintext highlighter-rouge">FLOAT</code>, <code class="language-plaintext highlighter-rouge">REAL</code>, <code class="language-plaintext highlighter-rouge">DOUBLE PRECISION</code>
</td>
    </tr>
    <tr>
      <td>Boolean</td>
      <td><code class="language-plaintext highlighter-rouge">BOOLEAN</code></td>
    </tr>
  </tbody>
</table>

<h3 id="cast">
<a class="anchor" href="#cast" aria-hidden="true"><span class="octicon octicon-link"></span></a>CAST</h3>
<ul>
  <li>In MySQL, changes data type of a column</li>
  <li>
    <p>In PostgreSQL, can also use <code class="language-plaintext highlighter-rouge">expression::type</code> casting syntax</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="k">CAST</span><span class="p">(</span><span class="n">col</span> <span class="k">AS</span> <span class="nb">Integer</span><span class="p">)</span> <span class="k">AS</span> <span class="n">int_col</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
  <span class="k">WHERE</span> <span class="k">CAST</span><span class="p">(</span><span class="n">col</span> <span class="k">AS</span> <span class="nb">Integer</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">10</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="dates">
<a class="anchor" href="#dates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dates</h3>
<ul>
  <li>
<code class="language-plaintext highlighter-rouge">DATE</code>, <code class="language-plaintext highlighter-rouge">DATETIME</code>, <code class="language-plaintext highlighter-rouge">TIMESTAMP</code> are date types used in SQL versions</li>
  <li>
<code class="language-plaintext highlighter-rouge">YYYY-MM-DD</code> is used for easy ordering, identical orders for dates and strings</li>
  <li>Date ranges are stored as <code class="language-plaintext highlighter-rouge">INTERVAL</code>
    <ul>
      <li>Intervals are defined in English terms, e.g. 10 seconds, 5 days, or 2 months</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Using intervals</span>
  <span class="k">SELECT</span> <span class="p">(</span><span class="k">CAST</span><span class="p">(</span><span class="k">table_name</span><span class="p">.</span><span class="nb">date</span> <span class="k">AS</span> <span class="nb">Timestamp</span><span class="p">)</span> <span class="o">+</span> <span class="n">INTERVAL</span> <span class="s1">'1 week'</span><span class="p">)</span> <span class="k">AS</span> <span class="n">week_after</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
</code></pre></div>    </div>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">EXTRACT(field FROM date_col)</code>: helps deconstruct dates
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">field</code> includes: <code class="language-plaintext highlighter-rouge">YEAR</code>, <code class="language-plaintext highlighter-rouge">MONTH</code>, <code class="language-plaintext highlighter-rouge">DAY</code>, <code class="language-plaintext highlighter-rouge">HOUR</code>, <code class="language-plaintext highlighter-rouge">SECOND</code>, <code class="language-plaintext highlighter-rouge">DECADE</code>, <code class="language-plaintext highlighter-rouge">DOW</code> (day of week)</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="k">EXTRACT</span><span class="p">(</span><span class="nb">YEAR</span> <span class="k">FROM</span> <span class="n">date_col</span><span class="p">)</span> <span class="k">AS</span> <span class="nb">year</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
</code></pre></div>    </div>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">DATE_TRUNC(field, date_col)</code>: rounds date to a specified precision
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">field</code> includes: <code class="language-plaintext highlighter-rouge">YEAR</code>, <code class="language-plaintext highlighter-rouge">MONTH</code>, <code class="language-plaintext highlighter-rouge">DAY</code>, <code class="language-plaintext highlighter-rouge">HOUR</code>, <code class="language-plaintext highlighter-rouge">SECOND</code>, <code class="language-plaintext highlighter-rouge">DECADE</code>
</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="n">DATE_TRUNC</span><span class="p">(</span><span class="k">DAY</span><span class="p">,</span> <span class="n">date_col</span><span class="p">)</span> <span class="k">AS</span> <span class="n">rounded_day</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
</code></pre></div>    </div>
  </li>
  <li>System Datetime Variables
    <ul>
      <li><code class="language-plaintext highlighter-rouge">CURRENT_DATE()</code></li>
      <li><code class="language-plaintext highlighter-rouge">CURRENT_TIME()</code></li>
      <li><code class="language-plaintext highlighter-rouge">CURRENT_TIMESTAMP()</code></li>
      <li><code class="language-plaintext highlighter-rouge">LOCALTIME()</code></li>
      <li><code class="language-plaintext highlighter-rouge">LOCALTIMESTAMP()</code></li>
      <li><code class="language-plaintext highlighter-rouge">NOW()</code></li>
      <li>To any above, can add <code class="language-plaintext highlighter-rouge">AT TIME ZONE timezone_code</code> to convert to a different timezone.</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="n">NOW</span><span class="p">()</span>

  <span class="k">SELECT</span> <span class="k">CURRENT_DATE</span><span class="p">()</span> <span class="k">AT</span> <span class="nb">TIME</span> <span class="k">ZONE</span> <span class="s1">'PST'</span> <span class="k">AS</span> <span class="n">current_date_pst</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="null-functions">
<a class="anchor" href="#null-functions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Null Functions</h3>
<ul>
  <li>Functions vary by SQL version</li>
  <li>
<code class="language-plaintext highlighter-rouge">IFNULL(col, value)</code>: returns default value if expression is null</li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">COALESCE(col, value)</code>: returns default value if expression is null</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="n">name</span><span class="p">,</span> <span class="n">price</span> <span class="o">*</span> <span class="p">(</span><span class="n">inventory</span> <span class="o">+</span> <span class="n">COALESCE</span><span class="p">(</span><span class="n">ordered</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
  <span class="k">FROM</span> <span class="n">products</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="string-functions">
<a class="anchor" href="#string-functions" aria-hidden="true"><span class="octicon octicon-link"></span></a>String Functions</h3>

<ul>
  <li>
<code class="language-plaintext highlighter-rouge">LEFT(str, n)</code>: get n characters from left end of string</li>
  <li>
<code class="language-plaintext highlighter-rouge">RIGHT(str, n)</code>: get n characters from right end of string</li>
  <li>
<code class="language-plaintext highlighter-rouge">TRIM(type chars FROM str)</code>: trim characters from string
    <ul>
      <li>
<code class="language-plaintext highlighter-rouge">TRIM(both '()' FROM col1)</code>: trim from both ends</li>
      <li>
<code class="language-plaintext highlighter-rouge">TRIM(leading '()' FROM col1)</code>: trim from front</li>
      <li>
<code class="language-plaintext highlighter-rouge">TRIM(trailing '()' FROM col1)</code>: trim from back</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">POSITION(substr IN str)</code>: get position of substring in string, case-sensitive</li>
  <li>
<code class="language-plaintext highlighter-rouge">STRPOS(str, substr)</code>: get position of substring in string, case-sensitive</li>
  <li>
<code class="language-plaintext highlighter-rouge">SUBSTR(str, start_idx, n)</code>: get n-length substring starting at index of string</li>
  <li>
<code class="language-plaintext highlighter-rouge">CONCAT(str, str, ...)</code>: concatenate strings</li>
  <li>
<code class="language-plaintext highlighter-rouge">str || str || ...</code>: concatenate strings</li>
  <li>
<code class="language-plaintext highlighter-rouge">UPPER(str)</code>: convert string to upper case</li>
  <li>
<code class="language-plaintext highlighter-rouge">LOWER(str)</code>: convert string to lower case</li>
</ul>

<h2 id="subqueries">
<a class="anchor" href="#subqueries" aria-hidden="true"><span class="octicon octicon-link"></span></a>Subqueries</h2>
<ul>
  <li>Subqueries are nested/inner queries to perform operations in multiple steps</li>
  <li>
    <p>Subqueries are required to have aliases</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="n">sub</span><span class="p">.</span><span class="o">*</span>
  <span class="k">FROM</span> <span class="p">(</span>
      <span class="k">SELECT</span> <span class="o">*</span>
      <span class="k">FROM</span> <span class="n">students</span>
      <span class="k">WHERE</span> <span class="n">grade</span> <span class="o">&gt;</span> <span class="mi">80</span>
  <span class="p">)</span> <span class="n">sub</span>
  <span class="k">WHERE</span> <span class="n">sub</span><span class="p">.</span><span class="n">class_level</span> <span class="o">=</span> <span class="s1">'Senior'</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Example: How many incidents happen, on average, on Fridays in December?</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Count # of incidents that happen on each day.</span>
  <span class="c1">-- Average # of daily incidents over each day of week (5: Friday) in month (December).</span>
  <span class="k">SELECT</span> <span class="k">EXTRACT</span><span class="p">(</span><span class="k">MONTH</span> <span class="k">FROM</span> <span class="n">sub</span><span class="p">.</span><span class="n">incident_date</span><span class="p">)</span> <span class="k">AS</span> <span class="nv">"Month"</span><span class="p">,</span>
         <span class="n">sub</span><span class="p">.</span><span class="n">day_of_week</span><span class="p">,</span>
         <span class="k">AVG</span><span class="p">(</span><span class="n">sub</span><span class="p">.</span><span class="n">daily_incidents</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="p">(</span>
      <span class="k">SELECT</span> <span class="k">EXTRACT</span><span class="p">(</span><span class="n">DOW</span> <span class="k">FROM</span> <span class="n">incident_date</span><span class="p">)</span> <span class="k">AS</span> <span class="n">day_of_week</span><span class="p">,</span>
             <span class="n">incident_date</span><span class="p">,</span>
             <span class="k">COUNT</span><span class="p">(</span><span class="n">incident_id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">incidents</span>
      <span class="k">FROM</span> <span class="n">log_table</span>
      <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
  <span class="p">)</span> <span class="n">sub</span>
  <span class="k">WHERE</span> <span class="n">sub</span><span class="p">.</span><span class="n">day_of_week</span> <span class="o">=</span> <span class="mi">5</span> <span class="k">AND</span> <span class="k">EXTRACT</span><span class="p">(</span><span class="k">MONTH</span> <span class="k">FROM</span> <span class="n">sub</span><span class="p">.</span><span class="n">incident_date</span><span class="p">)</span> <span class="o">=</span> <span class="mi">12</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Example: How many incidents happen for each category, averaged over all months?</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Count # of incidents per category that happen on each month</span>
  <span class="c1">-- Average # of incidents per category over all months</span>
  <span class="k">SELECT</span> <span class="n">sub</span><span class="p">.</span><span class="n">category</span><span class="p">,</span>
         <span class="k">AVG</span><span class="p">(</span><span class="n">sub</span><span class="p">.</span><span class="n">incidents</span><span class="p">)</span> <span class="k">AS</span> <span class="n">avg_incidents_per_month</span>
  <span class="k">FROM</span> <span class="p">(</span>
      <span class="k">SELECT</span> <span class="k">EXTRACT</span><span class="p">(</span><span class="k">MONTH</span> <span class="k">FROM</span> <span class="n">incident_date</span><span class="p">)</span> <span class="k">AS</span> <span class="nv">"month"</span><span class="p">,</span>
          <span class="n">category</span><span class="p">,</span>
          <span class="k">COUNT</span><span class="p">(</span><span class="n">incident_id</span><span class="p">)</span> <span class="k">as</span> <span class="n">incidents</span>
      <span class="k">FROM</span> <span class="n">log_table</span>
      <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
  <span class="p">)</span> <span class="n">sub</span>
  <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
</code></pre></div>    </div>
  </li>
  <li>Subqueries in Conditional Logic
    <ul>
      <li>
        <p>Don’t use aliases for subqueries in conditional statements</p>
      </li>
      <li>
        <p>Example: get all products that have min price</p>
      </li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="o">*</span>
  <span class="k">FROM</span> <span class="n">products</span>
  <span class="k">WHERE</span> <span class="n">price</span> <span class="o">=</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">MIN</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">products</span><span class="p">)</span> <span class="c1">-- subquery returns single cell</span>
</code></pre></div>    </div>

    <ul>
      <li>Example: get the products in the top 5 prices</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="o">*</span>
  <span class="k">FROM</span> <span class="n">products</span>
  <span class="k">WHERE</span> <span class="n">price</span> <span class="k">IN</span> <span class="p">(</span>
      <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">price</span>
      <span class="k">FROM</span> <span class="n">products</span>
      <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">price</span> <span class="k">DESC</span>
      <span class="k">LIMIT</span> <span class="mi">5</span>
  <span class="p">)</span> <span class="c1">-- subquery returns multiple cells (of one column)</span>
</code></pre></div>    </div>
  </li>
  <li>Joining Subqueries
    <ul>
      <li>Using filtering in the <code class="language-plaintext highlighter-rouge">ON</code> clause can handle cases when subquery returns one or multiple rows</li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">ON</code> filtering is the same as <code class="language-plaintext highlighter-rouge">WHERE</code> filtering for <code class="language-plaintext highlighter-rouge">INNER JOINS</code></p>
      </li>
      <li>Example: get the products in the top 5 prices</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="o">*</span>
  <span class="k">FROM</span> <span class="n">products</span>
  <span class="k">JOIN</span> <span class="p">(</span>
      <span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">price</span>
      <span class="k">FROM</span> <span class="n">products</span>
      <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">price</span> <span class="k">DESC</span>
      <span class="k">LIMIT</span> <span class="mi">5</span>
  <span class="p">)</span> <span class="n">sub</span>
  <span class="k">ON</span> <span class="n">products</span><span class="p">.</span><span class="n">price</span> <span class="o">=</span> <span class="n">sub</span><span class="p">.</span><span class="n">price</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Joining Subqueries with Aggregation Functions</p>

    <ul>
      <li>Example: <a href="http://sqlfiddle.com/#!9/06d2bf/3/0">Find the products from the top 3 categories with the least counts.</a>
</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- subquery returns top 3 categories with least product counts</span>
  <span class="c1">-- query selects all products in the specified 3 categories</span>
  <span class="c1">-- result set is ordered by count and descending price</span>
  <span class="c1">-- (products with same category have same counts)</span>
  <span class="k">SELECT</span> <span class="n">products</span><span class="p">.</span><span class="o">*</span><span class="p">,</span> <span class="n">sub</span><span class="p">.</span><span class="k">c</span> <span class="k">AS</span> <span class="n">counts</span>
  <span class="k">FROM</span> <span class="n">products</span>
  <span class="k">JOIN</span> <span class="p">(</span>
      <span class="k">SELECT</span> <span class="n">category</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">AS</span> <span class="k">c</span>
      <span class="k">FROM</span> <span class="n">products</span>
      <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">category</span>
      <span class="k">ORDER</span> <span class="k">BY</span> <span class="k">c</span>
      <span class="k">LIMIT</span> <span class="mi">3</span>
  <span class="p">)</span> <span class="n">sub</span>
  <span class="k">ON</span> <span class="n">products</span><span class="p">.</span><span class="n">category</span> <span class="o">=</span> <span class="n">sub</span><span class="p">.</span><span class="n">category</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">sub</span><span class="p">.</span><span class="k">c</span><span class="p">,</span> <span class="n">products</span><span class="p">.</span><span class="n">price</span> <span class="k">DESC</span>
</code></pre></div>    </div>

    <ul>
      <li>Unlike using <code class="language-plaintext highlighter-rouge">WHERE col IN (subquery)</code>, <code class="language-plaintext highlighter-rouge">JOIN (subquery) ON table.col=sub.col</code> allows  aggregated values to be passed into the outer query because an <code class="language-plaintext highlighter-rouge">IN</code> clause is limited to one set of values.
        <ul>
          <li>Additionally, MySQL does not allow <code class="language-plaintext highlighter-rouge">LIMIT</code> in subqueries in the <code class="language-plaintext highlighter-rouge">WHERE</code> clause.</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>Using Subqueries to Improve Performance
    <ul>
      <li>Inefficient: <code class="language-plaintext highlighter-rouge">FULL JOIN</code> creates a huge intermediate join table</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Get counts of A and B entities per month</span>
  <span class="k">SELECT</span> <span class="n">COALESCE</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="k">month</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="k">month</span><span class="p">)</span> <span class="k">AS</span> <span class="k">month</span><span class="p">,</span> <span class="c1">-- fill null values of outer join</span>
         <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">A</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">count_A</span><span class="p">,</span>
         <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">B</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">count_B</span>
  <span class="k">FROM</span> <span class="n">A</span>
  <span class="k">FULL</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">B</span> <span class="c1">-- creates a large intermediate join table</span>
  <span class="k">ON</span> <span class="n">A</span><span class="p">.</span><span class="k">month</span> <span class="o">=</span> <span class="n">B</span><span class="p">.</span><span class="k">month</span>
  <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
</code></pre></div>    </div>

    <ul>
      <li>
        <p>Intermediate Join Table</p>

        <table>
          <thead>
            <tr>
              <th>A.id</th>
              <th>A.month</th>
              <th>B.month</th>
              <th>B.id</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>1</td>
              <td>A</td>
              <td>A</td>
              <td>5</td>
            </tr>
            <tr>
              <td>1</td>
              <td>A</td>
              <td>A</td>
              <td>6</td>
            </tr>
            <tr>
              <td>2</td>
              <td>B</td>
              <td>B</td>
              <td>7</td>
            </tr>
            <tr>
              <td>3</td>
              <td>B</td>
              <td>B</td>
              <td>7</td>
            </tr>
            <tr>
              <td>4</td>
              <td>C</td>
              <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
              <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
            </tr>
            <tr>
              <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
              <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
              <td>D</td>
              <td>8</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>
        <p>Result</p>

        <table>
          <thead>
            <tr>
              <th>month</th>
              <th>count_A</th>
              <th>count_B</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>A</td>
              <td>1</td>
              <td>2</td>
            </tr>
            <tr>
              <td>B</td>
              <td>2</td>
              <td>1</td>
            </tr>
            <tr>
              <td>C</td>
              <td>1</td>
              <td>0</td>
            </tr>
            <tr>
              <td>D</td>
              <td>0</td>
              <td>1</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>
        <p>Optimized: Use subqueries to divide the problem into smaller tables before joining</p>
      </li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Get counts of A and B entities per month</span>
  <span class="c1">-- Pre-aggregate counts in A and B separately before joining </span>
  <span class="k">SELECT</span> <span class="n">COALESCE</span><span class="p">(</span><span class="n">A</span><span class="p">.</span><span class="k">month</span><span class="p">,</span> <span class="n">B</span><span class="p">.</span><span class="k">month</span><span class="p">)</span> <span class="k">as</span> <span class="k">month</span><span class="p">,</span>
         <span class="n">subA</span><span class="p">.</span><span class="n">count_A</span><span class="p">,</span>
         <span class="n">subB</span><span class="p">.</span><span class="n">count_B</span>
  <span class="k">FROM</span> <span class="p">(</span>
      <span class="k">SELECT</span> <span class="k">month</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">count_A</span>
      <span class="k">FROM</span> <span class="n">A</span>
      <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
  <span class="p">)</span> <span class="n">subA</span>
  <span class="k">FULL</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="p">(</span>
      <span class="k">SELECT</span> <span class="k">month</span><span class="p">,</span> <span class="k">COUNT</span><span class="p">(</span><span class="k">DISTINCT</span> <span class="n">id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">count_B</span>
      <span class="k">FROM</span> <span class="n">B</span>
      <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span>
  <span class="p">)</span> <span class="n">subB</span>
  <span class="k">ON</span> <span class="n">subA</span><span class="p">.</span><span class="k">month</span> <span class="o">=</span> <span class="n">subB</span><span class="p">.</span><span class="k">month</span>
</code></pre></div>    </div>

    <ul>
      <li>
        <p>Intermediate Join Tables</p>

        <table>
          <thead>
            <tr>
              <th>month</th>
              <th>count_A</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>A</td>
              <td>1</td>
            </tr>
            <tr>
              <td>B</td>
              <td>2</td>
            </tr>
            <tr>
              <td>C</td>
              <td>1</td>
            </tr>
          </tbody>
        </table>

        <table>
          <thead>
            <tr>
              <th>month</th>
              <th>count_B</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>A</td>
              <td>2</td>
            </tr>
            <tr>
              <td>B</td>
              <td>1</td>
            </tr>
            <tr>
              <td>D</td>
              <td>1</td>
            </tr>
          </tbody>
        </table>
      </li>
      <li>
        <p>Result</p>

        <table>
          <thead>
            <tr>
              <th>month</th>
              <th>count_A</th>
              <th>count_B</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>A</td>
              <td>1</td>
              <td>2</td>
            </tr>
            <tr>
              <td>B</td>
              <td>2</td>
              <td>1</td>
            </tr>
            <tr>
              <td>C</td>
              <td>1</td>
              <td>0</td>
            </tr>
            <tr>
              <td>D</td>
              <td>0</td>
              <td>1</td>
            </tr>
          </tbody>
        </table>
      </li>
    </ul>
  </li>
  <li>The two methods get the same result, but the join using subqueries is faster because operating on smaller intermediate join tables is more efficient.
    <ul>
      <li>Method 1 joins both tables then gets counts for A and B per month.</li>
      <li>Method 2 gets counts for A and B per month separately, then joins the results together.</li>
    </ul>
  </li>
</ul>

<h3 id="window-functions">
<a class="anchor" href="#window-functions" aria-hidden="true"><span class="octicon octicon-link"></span></a>Window Functions</h3>
<ul>
  <li>A <strong>window</strong> is a group of related rows that are somehow related the current row, e.g. all rows with same month or same city</li>
  <li>A <strong>window function</strong> performs calculation across a window,
    <ul>
      <li>Unlike aggregation functions, window functions don’t group rows into a single output row
        <ul>
          <li>No need to group by non-aggregated rows</li>
        </ul>
      </li>
      <li>Window functions are able to access more than just the current row of query result</li>
      <li>A <strong>window function</strong> takes in a column/row and a window of related rows that includes the row</li>
    </ul>
  </li>
  <li>Aggregation functions can serve as window functions
    <ul>
      <li>Inside <code class="language-plaintext highlighter-rouge">OVER()</code>, use <code class="language-plaintext highlighter-rouge">ORDER BY</code> to sort the window by a column</li>
      <li>Cannot use <code class="language-plaintext highlighter-rouge">GROUP BY</code> with window functions</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="k">SUM</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(...)</span>
  <span class="k">SELECT</span> <span class="k">COUNT</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(...)</span>
  <span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">col</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(...)</span>

  <span class="c1">-- Example: Get a running total</span>
  <span class="c1">-- Using SUM as a window function</span>
  <span class="c1">-- ORDER BY to calculate chronologically</span>
  <span class="k">SELECT</span> <span class="n">duration</span><span class="p">,</span>
         <span class="k">SUM</span><span class="p">(</span><span class="n">duration</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">ORDER</span> <span class="k">BY</span> <span class="n">start_time</span><span class="p">)</span> <span class="k">AS</span> <span class="n">running_total</span>
  <span class="k">FROM</span> <span class="n">rides</span>
</code></pre></div>    </div>

    <ul>
      <li>Window Result
        <ul>
          <li>Durations are summed and ordered by start_time to create a running total</li>
          <li>Without <code class="language-plaintext highlighter-rouge">ORDER BY</code>, each value would be sum of all seconds in its partition</li>
        </ul>
      </li>
    </ul>

    <table>
      <thead>
        <tr>
          <th>duration</th>
          <th>running_total</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>1</td>
        </tr>
        <tr>
          <td>1</td>
          <td>2</td>
        </tr>
        <tr>
          <td>2</td>
          <td>4</td>
        </tr>
        <tr>
          <td>1</td>
          <td>5</td>
        </tr>
        <tr>
          <td>4</td>
          <td>9</td>
        </tr>
        <tr>
          <td>3</td>
          <td>12</td>
        </tr>
      </tbody>
    </table>
  </li>
  <li>Apply window function over individual groups
    <ul>
      <li>Inside <code class="language-plaintext highlighter-rouge">OVER()</code>, use <code class="language-plaintext highlighter-rouge">PARTITION BY</code> to specify how the window function builds the window
        <ul>
          <li>Each partition will be treated as one window, upon which the function will be applied</li>
        </ul>
      </li>
      <li>Without <code class="language-plaintext highlighter-rouge">PARTITION BY</code>, the whole table will be treated as one window</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- using aggregation, cannot get individual information from all employees</span>
  <span class="k">SELECT</span> <span class="n">dept_name</span><span class="p">,</span> <span class="k">MAX</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span> <span class="k">AS</span> <span class="n">max_salary</span>
  <span class="k">FROM</span> <span class="n">employees</span>
  <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">dept_name</span>

  <span class="c1">-- better to use window function</span>
  <span class="c1">-- PARTITION BY specifies how to group rows to form a window</span>
  <span class="k">SELECT</span> <span class="n">E</span><span class="p">.</span><span class="o">*</span><span class="p">,</span>
         <span class="k">MAX</span><span class="p">(</span><span class="n">salary</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">dept_name</span><span class="p">)</span> <span class="k">AS</span> <span class="n">max_salary</span>
  <span class="k">FROM</span> <span class="n">employees</span> <span class="n">E</span>
</code></pre></div>    </div>

    <ul>
      <li>The aggregation will return each department and the max salary of that department, without any other employee data.</li>
      <li>The window function will return every employee data with the max salary of the department that employee works in
        <ul>
          <li>The window function duplicates the department’s max salary to every row</li>
          <li>Without <code class="language-plaintext highlighter-rouge">PARTITION BY</code>, the max salary of all departments will be duplicated for every row</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">ROW_NUMBER()</code>: window function that returns number of row</p>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">RANK()</code>: window function that ranks values
    <ul>
      <li>Like <code class="language-plaintext highlighter-rouge">ROW_NUMBER()</code> but gives same values when tied, e.g. 1, 2, 2, 4, 4, 4, 7</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">DENSE_RANK()</code>: window function that ranks values without skipping numbers
    <ul>
      <li>Like <code class="language-plaintext highlighter-rouge">RANK()</code> but does not skip values, e.g. 1, 2, 2, 3, 3, 3, 4</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="n">team</span><span class="p">,</span> <span class="n">score</span><span class="p">,</span>
         <span class="n">ROW_NUMBER</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">team</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">score</span><span class="p">),</span>
         <span class="n">RANK</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">team</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">score</span><span class="p">),</span>
         <span class="n">DENSE_RANK</span><span class="p">(</span><span class="n">score</span><span class="p">)</span> <span class="n">OVER</span><span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">team</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">score</span><span class="p">)</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
</code></pre></div>    </div>

    <table>
      <thead>
        <tr>
          <th>Team</th>
          <th>Score</th>
          <th><code class="language-plaintext highlighter-rouge">ROW_NUMBER()</code></th>
          <th><code class="language-plaintext highlighter-rouge">RANK()</code></th>
          <th><code class="language-plaintext highlighter-rouge">DENSE_RANK()</code></th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>A</td>
          <td>30</td>
          <td>1</td>
          <td>1</td>
          <td>1</td>
        </tr>
        <tr>
          <td>A</td>
          <td>40</td>
          <td>2</td>
          <td>2</td>
          <td>2</td>
        </tr>
        <tr>
          <td>A</td>
          <td>40</td>
          <td>3</td>
          <td>2</td>
          <td>2</td>
        </tr>
        <tr>
          <td>A</td>
          <td>55</td>
          <td>4</td>
          <td>4</td>
          <td>3</td>
        </tr>
        <tr>
          <td>B</td>
          <td>20</td>
          <td>1</td>
          <td>1</td>
          <td>1</td>
        </tr>
        <tr>
          <td>B</td>
          <td>20</td>
          <td>2</td>
          <td>1</td>
          <td>1</td>
        </tr>
        <tr>
          <td>B</td>
          <td>35</td>
          <td>3</td>
          <td>3</td>
          <td>2</td>
        </tr>
        <tr>
          <td>C</td>
          <td>20</td>
          <td>1</td>
          <td>1</td>
          <td>1</td>
        </tr>
      </tbody>
    </table>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Fetch the top 3 employees in each department by salary</span>
  <span class="c1">-- Using ROW_NUMBER() may miss out on other employees tied for top 3 salary values</span>
  <span class="k">SELECT</span> <span class="o">*</span>
  <span class="k">FROM</span> <span class="p">(</span>
      <span class="k">SELECT</span> <span class="n">E</span><span class="p">.</span><span class="o">*</span><span class="p">,</span>
             <span class="n">ROW_NUMBER</span><span class="p">()</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">dept_name</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">salary</span> <span class="k">DESC</span><span class="p">)</span> <span class="k">AS</span> <span class="n">salary_num</span>
      <span class="k">FROM</span> <span class="n">employee</span> <span class="n">E</span>
  <span class="p">)</span> <span class="n">sub</span>
  <span class="k">WHERE</span> <span class="n">sub</span><span class="p">.</span><span class="n">salary_num</span> <span class="o">&lt;</span> <span class="mi">4</span>

  <span class="c1">-- Fetch the top employees in each department</span>
  <span class="c1">-- who earn the top 3 salaries in their department</span>
  <span class="c1">-- Returns every employee earning one of the top 3 salaries in their department</span>
  <span class="k">SELECT</span> <span class="o">*</span>
  <span class="k">FROM</span> <span class="p">(</span>
      <span class="k">SELECT</span> <span class="n">E</span><span class="p">.</span><span class="o">*</span><span class="p">,</span>
             <span class="n">RANK</span><span class="p">()</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">dept_name</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">salary</span> <span class="k">DESC</span><span class="p">)</span> <span class="k">AS</span> <span class="n">salary_rank</span>
      <span class="k">FROM</span> <span class="n">employee</span> <span class="n">E</span>
  <span class="p">)</span> <span class="n">sub</span>
  <span class="k">WHERE</span> <span class="n">sub</span><span class="p">.</span><span class="n">salary_rank</span> <span class="o">&lt;</span> <span class="mi">4</span>
</code></pre></div>    </div>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">NTILE(n)</code>: window function that determines which bucket row falls in
    <ul>
      <li>e.g. use n = 4 for quartile, or n = 100 for percentile</li>
      <li>For small partition rows with less rows than tiles, the tiles will resemble a numerical ranking</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- get quartile and percentile of student scores for each class</span>
  <span class="k">SELECT</span> <span class="k">class</span><span class="p">,</span>
         <span class="n">score</span><span class="p">,</span>
         <span class="n">NTILE</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="k">class</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">score</span> <span class="k">DESC</span><span class="p">)</span> <span class="k">AS</span> <span class="n">quartile</span><span class="p">,</span>
         <span class="n">NTILE</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="k">class</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">score</span> <span class="k">DESC</span><span class="p">)</span> <span class="k">AS</span> <span class="n">percentile</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
</code></pre></div>    </div>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">LAG(col, n)</code>: window function that creates a column that pulls from the previous n rows of col
    <ul>
      <li>First n rows of column will be <code class="language-plaintext highlighter-rouge">NULL</code> because no previous rows to pull from</li>
      <li>Some versions of SQL allow default values, i.e. <code class="language-plaintext highlighter-rouge">LAG(col, n, default)</code>, to fill in <code class="language-plaintext highlighter-rouge">NULL</code> values</li>
    </ul>
  </li>
  <li>
<code class="language-plaintext highlighter-rouge">LEAD(col, n)</code>: window function that creates a column that pulls from next n rows of col
    <ul>
      <li>Last n rows of column will be <code class="language-plaintext highlighter-rouge">NULL</code> because no previous rows to pull from</li>
      <li>Some versions of SQL allow default values, i.e. <code class="language-plaintext highlighter-rouge">LEAD(col, n, default)</code>, to fill in <code class="language-plaintext highlighter-rouge">NULL</code> values</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Example of lag and lead score, partitioned on team</span>
  <span class="k">SELECT</span> <span class="n">team</span><span class="p">,</span>
         <span class="n">score</span><span class="p">,</span>
         <span class="n">LAG</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">team</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">score</span><span class="p">)</span> <span class="k">AS</span> <span class="n">lag_score</span><span class="p">,</span>
         <span class="n">LEAD</span><span class="p">(</span><span class="n">score</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">team</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">score</span><span class="p">)</span> <span class="k">AS</span> <span class="n">lead_score</span>
  <span class="k">FROM</span> <span class="k">table_name</span>
</code></pre></div>    </div>

    <table>
      <thead>
        <tr>
          <th>team</th>
          <th>score</th>
          <th>lag_score</th>
          <th>lead_score</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>A</td>
          <td>20</td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
          <td>30</td>
        </tr>
        <tr>
          <td>A</td>
          <td>30</td>
          <td>20</td>
          <td>40</td>
        </tr>
        <tr>
          <td>A</td>
          <td>40</td>
          <td>30</td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
        </tr>
        <tr>
          <td>B</td>
          <td>30</td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
          <td>60</td>
        </tr>
        <tr>
          <td>B</td>
          <td>60</td>
          <td>30</td>
          <td>70</td>
        </tr>
        <tr>
          <td>B</td>
          <td>70</td>
          <td>50</td>
          <td>75</td>
        </tr>
        <tr>
          <td>B</td>
          <td>75</td>
          <td>70</td>
          <td><code class="language-plaintext highlighter-rouge">NULL</code></td>
        </tr>
      </tbody>
    </table>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Show if the salary of an employee is higher, lower, or equal to the previous employee.</span>
  <span class="k">SELECT</span> <span class="n">E</span><span class="p">.</span><span class="o">*</span><span class="p">,</span>
         <span class="n">LAG</span><span class="p">(</span><span class="n">salary</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">dept_name</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id</span><span class="p">)</span> <span class="k">AS</span> <span class="n">prev_emp_salary</span><span class="p">,</span>
         <span class="k">CASE</span> <span class="k">WHEN</span> <span class="n">E</span><span class="p">.</span><span class="n">salary</span> <span class="o">&gt;</span> <span class="n">LAG</span><span class="p">(</span><span class="n">salary</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">dept_name</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id</span> <span class="k">THEN</span> <span class="s1">'Higher'</span>
         <span class="k">WHEN</span> <span class="n">E</span><span class="p">.</span><span class="n">salary</span> <span class="o">&lt;</span> <span class="n">LAG</span><span class="p">(</span><span class="n">salary</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="n">dept_name</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">id</span><span class="p">)</span> <span class="k">THEN</span> <span class="s1">'Lower'</span>
         <span class="k">ELSE</span> <span class="s1">'Equal'</span> <span class="k">END</span> <span class="k">AS</span> <span class="n">salary_range</span>
  <span class="k">FROM</span> <span class="n">employee</span> <span class="n">E</span>
</code></pre></div>    </div>

    <table>
      <thead>
        <tr>
          <th>id</th>
          <th>name</th>
          <th>dept_name</th>
          <th>salary</th>
          <th>prev_emp_salary</th>
          <th>salary_range</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>1</td>
          <td>Anna</td>
          <td>Admin</td>
          <td>4000</td>
          <td>0</td>
          <td>Higher</td>
        </tr>
        <tr>
          <td>3</td>
          <td>Bert</td>
          <td>Admin</td>
          <td>5000</td>
          <td>4000</td>
          <td>Higher</td>
        </tr>
        <tr>
          <td>4</td>
          <td>Dirk</td>
          <td>Admin</td>
          <td>3000</td>
          <td>5000</td>
          <td>Lower</td>
        </tr>
        <tr>
          <td>6</td>
          <td>Cris</td>
          <td>Admin</td>
          <td>6000</td>
          <td>3000</td>
          <td>Higher</td>
        </tr>
        <tr>
          <td>2</td>
          <td>Kurt</td>
          <td>Finance</td>
          <td>4000</td>
          <td>0</td>
          <td>Higher</td>
        </tr>
        <tr>
          <td>5</td>
          <td>Fred</td>
          <td>Finance</td>
          <td>5000</td>
          <td>4000</td>
          <td>Higher</td>
        </tr>
        <tr>
          <td>7</td>
          <td>Paul</td>
          <td>Finance</td>
          <td>5000</td>
          <td>5000</td>
          <td>Equal</td>
        </tr>
        <tr>
          <td>8</td>
          <td>Evan</td>
          <td>Finance</td>
          <td>2000</td>
          <td>5000</td>
          <td>Lower</td>
        </tr>
      </tbody>
    </table>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Example of removing null rows using subquery</span>
  <span class="k">SELECT</span> <span class="n">sub</span><span class="p">.</span><span class="o">*</span>
  <span class="k">FROM</span> <span class="p">(</span>
      <span class="k">SELECT</span> <span class="k">location</span><span class="p">,</span>
             <span class="n">duration</span> <span class="o">-</span> <span class="n">LAG</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="n">OVER</span> <span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="k">location</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">duration</span><span class="p">)</span> <span class="k">AS</span> <span class="n">difference</span>
      <span class="k">FROM</span> <span class="n">rides</span>
  <span class="p">)</span> <span class="n">sub</span>
  <span class="k">WHERE</span> <span class="n">sub</span><span class="p">.</span><span class="n">difference</span> <span class="k">IS</span> <span class="k">NOT</span> <span class="k">NULL</span>
</code></pre></div>    </div>
  </li>
  <li>Window Aliases
    <ul>
      <li>can name and re-use same window for several queries</li>
      <li>should always come after the <code class="language-plaintext highlighter-rouge">WHERE</code> clause</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="k">location</span><span class="p">,</span>
         <span class="n">duration</span><span class="p">,</span>
         <span class="n">NTILE</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span> <span class="n">OVER</span> <span class="n">ntile_window</span> <span class="k">AS</span> <span class="n">quartile</span><span class="p">,</span>
         <span class="n">NTILE</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="n">OVER</span> <span class="n">ntile_window</span> <span class="k">AS</span> <span class="n">percentile</span>
  <span class="k">FROM</span> <span class="n">rides</span>
  <span class="k">WINDOW</span> <span class="n">ntile_window</span> <span class="k">AS</span> <span class="p">(</span><span class="k">PARTITION</span> <span class="k">BY</span> <span class="k">location</span> <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">duration</span><span class="p">)</span> <span class="c1">-- window alias</span>
  <span class="k">ORDER</span> <span class="k">BY</span> <span class="k">location</span><span class="p">,</span> <span class="n">duration</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="select-into">
<a class="anchor" href="#select-into" aria-hidden="true"><span class="octicon octicon-link"></span></a>SELECT INTO</h3>
<ul>
  <li>
    <p>Copies data from one table into a new table (in external database)</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">SELECT</span> <span class="o">*</span>
  <span class="k">INTO</span> <span class="n">adults</span> <span class="k">IN</span> <span class="s1">'backup.db'</span> <span class="c1">-- optional: [IN external_db]</span>
  <span class="k">FROM</span> <span class="n">users</span>
  <span class="k">WHERE</span> <span class="n">age</span> <span class="o">&gt;=</span> <span class="mi">18</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="update">
<a class="anchor" href="#update" aria-hidden="true"><span class="octicon octicon-link"></span></a>UPDATE</h3>
<ul>
  <li>
    <p>Modifies existing records in a table</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">UPDATE</span> <span class="k">table_name</span>
  <span class="k">SET</span> <span class="n">col1</span> <span class="o">=</span> <span class="n">val1</span><span class="p">,</span> <span class="n">col2</span> <span class="o">=</span> <span class="n">val2</span><span class="p">,</span> <span class="p">...</span>
  <span class="k">WHERE</span> <span class="n">condition</span> <span class="c1">-- without WHERE clause, all rows will be updated</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="delete">
<a class="anchor" href="#delete" aria-hidden="true"><span class="octicon octicon-link"></span></a>DELETE</h3>
<ul>
  <li>Deletes data in a database</li>
</ul>

<h3 id="insert-into">
<a class="anchor" href="#insert-into" aria-hidden="true"><span class="octicon octicon-link"></span></a>INSERT INTO</h3>
<ul>
  <li>
    <p>Inserts new data into a database</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- specifying which columns, values to insert</span>
  <span class="k">INSERT</span> <span class="k">INTO</span> <span class="k">table_name</span> <span class="p">(</span><span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">,</span> <span class="n">col3</span><span class="p">,</span> <span class="p">...)</span>
  <span class="k">VALUES</span> <span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">val3</span><span class="p">,</span> <span class="p">...)</span>

  <span class="c1">-- don't need to specify if adding all columns</span>
  <span class="k">INSERT</span> <span class="k">INTO</span> <span class="k">table_name</span>
  <span class="k">VALUES</span> <span class="p">(</span><span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">val3</span><span class="p">,</span> <span class="n">val4</span><span class="p">,</span> <span class="n">val5</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="insert-into-select">
<a class="anchor" href="#insert-into-select" aria-hidden="true"><span class="octicon octicon-link"></span></a>INSERT INTO SELECT</h3>
<ul>
  <li>Copies data from one table and inserts it into another table</li>
  <li>
    <p>data types in source and destination tables must match</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">all_profits</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">current_profits</span>
  <span class="k">WHERE</span> <span class="n">company</span> <span class="o">=</span> <span class="s1">'Apple'</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="common-table-expressions-cte">
<a class="anchor" href="#common-table-expressions-cte" aria-hidden="true"><span class="octicon octicon-link"></span></a>Common Table Expressions (CTE)</h3>
<ul>
  <li>A temporary named result set that can be referenced within <code class="language-plaintext highlighter-rouge">SELECT</code>, <code class="language-plaintext highlighter-rouge">INSERT</code>, <code class="language-plaintext highlighter-rouge">UPDATE</code>, or <code class="language-plaintext highlighter-rouge">DELETE</code> statements, also used in a <code class="language-plaintext highlighter-rouge">CREATE</code> to create a view</li>
  <li>
    <p>Advantage over subqueries: CTEs can be use multiple times in a query</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Find average grades for every senior student</span>
  <span class="k">WITH</span> <span class="n">cte_student_grades</span> <span class="p">(</span><span class="n">student</span><span class="p">,</span> <span class="n">class_year</span><span class="p">,</span> <span class="n">avg_grade</span><span class="p">)</span> <span class="k">AS</span> <span class="p">(</span>
      <span class="k">SELECT</span> 
          <span class="n">S</span><span class="p">.</span><span class="n">first_name</span> <span class="o">+</span> <span class="s1">' '</span> <span class="o">+</span> <span class="n">S</span><span class="p">.</span><span class="n">last_name</span><span class="p">,</span>
          <span class="nb">YEAR</span><span class="p">(</span><span class="n">S</span><span class="p">.</span><span class="n">graduation_date</span><span class="p">),</span>
          <span class="k">AVG</span><span class="p">(</span><span class="n">E</span><span class="p">.</span><span class="n">grade</span><span class="p">)</span>
      <span class="k">FROM</span> <span class="n">students</span> <span class="n">S</span>
      <span class="k">JOIN</span> <span class="n">exams</span> <span class="n">E</span>
      <span class="k">ON</span> <span class="n">S</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">E</span><span class="p">.</span><span class="n">student_id</span>
      <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">first_name</span> <span class="o">+</span> <span class="s1">' '</span> <span class="o">+</span> <span class="n">last_name</span><span class="p">,</span> <span class="nb">YEAR</span><span class="p">(</span><span class="n">graduation_date</span><span class="p">)</span>
  <span class="p">)</span>
  <span class="c1">-- use CTE in a SELECT statement</span>
  <span class="k">SELECT</span> <span class="n">student</span><span class="p">,</span> <span class="n">avg_grade</span><span class="p">,</span> <span class="s1">'Senior'</span> <span class="k">AS</span> <span class="n">class_level</span>
  <span class="k">FROM</span> <span class="n">cte_student_grades</span>
  <span class="k">WHERE</span> <span class="n">class_year</span> <span class="o">=</span> <span class="mi">2021</span>
</code></pre></div>    </div>
  </li>
  <li>Use to perform multi-level aggregations, e.g. average minimum grade <code class="language-plaintext highlighter-rouge">AVG(MIN(grade))</code>
    <ul>
      <li>SQL does not allow subqueries or aggregate functions inside an aggregate function</li>
      <li>SO you have to do <code class="language-plaintext highlighter-rouge">MIN(grade)</code> first in a CTE, then do <code class="language-plaintext highlighter-rouge">AVG(min_grade)</code>
</li>
    </ul>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Find average min and average max exam grades across all subjects</span>
  <span class="k">WITH</span> <span class="n">min_max_grade</span> <span class="k">AS</span> <span class="p">(</span>
      <span class="k">SELECT</span>  <span class="n">SU</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
              <span class="n">SU</span><span class="p">.</span><span class="n">subject_name</span><span class="p">,</span>
              <span class="k">MIN</span><span class="p">(</span><span class="n">E</span><span class="p">.</span><span class="n">grade</span><span class="p">)</span> <span class="k">AS</span> <span class="n">min_grade</span><span class="p">,</span>
              <span class="k">MAX</span><span class="p">(</span><span class="n">E</span><span class="p">.</span><span class="n">grade</span><span class="p">)</span> <span class="k">AS</span> <span class="n">max_grade</span>
      <span class="k">FROM</span> <span class="n">subjects</span> <span class="n">SU</span>
      <span class="k">JOIN</span> <span class="n">exams</span> <span class="n">E</span>
      <span class="k">ON</span> <span class="n">SU</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">E</span><span class="p">.</span><span class="n">subject_id</span>
      <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">SU</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="n">SU</span><span class="p">.</span><span class="n">subject_name</span>
  <span class="p">)</span>

  <span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">min_grade</span><span class="p">)</span> <span class="k">AS</span> <span class="n">avg_min_grade</span><span class="p">,</span>
         <span class="k">AVG</span><span class="p">(</span><span class="n">max_grade</span><span class="p">)</span> <span class="k">AS</span> <span class="n">avg_max_grade</span>
  <span class="k">FROM</span> <span class="n">min_max_grade</span><span class="p">;</span> <span class="c1">-- use CTE in a query</span>

  <span class="c1">-- Alternatively, subqueries are not as readable, reusable,</span>
  <span class="c1">-- and opposite in terms of thought process (AVG -&gt; MIN/MAX)</span>
  <span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">min_grade</span><span class="p">)</span> <span class="k">AS</span> <span class="n">avg_min_grade</span><span class="p">,</span>
         <span class="k">AVG</span><span class="p">(</span><span class="n">max_grade</span><span class="p">)</span> <span class="k">AS</span> <span class="n">avg_max_grade</span>
  <span class="k">FROM</span> <span class="p">(</span>
      <span class="k">SELECT</span> <span class="n">SU</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
             <span class="n">SU</span><span class="p">.</span><span class="n">subject_name</span><span class="p">,</span>
             <span class="k">MIN</span><span class="p">(</span><span class="n">E</span><span class="p">.</span><span class="n">grade</span><span class="p">)</span> <span class="k">AS</span> <span class="n">min_grade</span>
             <span class="k">MAX</span><span class="p">(</span><span class="n">E</span><span class="p">.</span><span class="n">grade</span><span class="p">)</span> <span class="k">AS</span> <span class="n">max_grade</span>
      <span class="k">FROM</span> <span class="n">subjects</span> <span class="n">SU</span>
      <span class="k">JOIN</span> <span class="n">exams</span> <span class="n">E</span>
      <span class="k">ON</span> <span class="n">SU</span><span class="p">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">E</span><span class="p">.</span><span class="n">subject_id</span>
      <span class="k">GROUP</span> <span class="k">BY</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
  <span class="p">)</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="stored-procedures">
<a class="anchor" href="#stored-procedures" aria-hidden="true"><span class="octicon octicon-link"></span></a>Stored Procedures</h3>
<ul>
  <li>
    <p>A prepared SQL code that can be saved and reused, like a function</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Storing procedure</span>
  <span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">SelectAllUsers</span>
  <span class="k">AS</span>
      <span class="k">SELECT</span> <span class="o">*</span>
      <span class="k">FROM</span> <span class="n">Users</span>
  <span class="k">GO</span>

  <span class="c1">-- Executing procedure</span>
  <span class="k">EXEC</span> <span class="n">SelectAllUsers</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>A procedure can take in parameters</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Storing procedure</span>
  <span class="k">CREATE</span> <span class="k">PROCEDURE</span> <span class="n">SelectAllUsers</span> <span class="o">@</span><span class="n">City</span> <span class="n">nvarchar</span><span class="p">(</span><span class="mi">30</span><span class="p">),</span> <span class="o">@</span><span class="n">MinAge</span> <span class="nb">Int</span>
  <span class="k">AS</span>
      <span class="k">SELECT</span> <span class="o">*</span>
      <span class="k">FROM</span> <span class="n">Users</span>
      <span class="k">WHERE</span> <span class="n">city</span> <span class="o">=</span> <span class="o">@</span><span class="n">City</span> <span class="k">AND</span> <span class="n">age</span> <span class="o">&gt;=</span> <span class="o">@</span><span class="n">MinAge</span>
  <span class="k">GO</span>

  <span class="c1">-- Executing procedure</span>
  <span class="k">EXEC</span> <span class="n">SelectAllUsers</span> <span class="o">@</span><span class="n">City</span> <span class="o">=</span> <span class="s1">'Los Angeles'</span><span class="p">,</span> <span class="o">@</span><span class="n">MinAge</span> <span class="o">=</span> <span class="mi">18</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="sql-database">
<a class="anchor" href="#sql-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>SQL Database</h2>

<h3 id="create-database">
<a class="anchor" href="#create-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>CREATE DATABASE</h3>
<ul>
  <li>Creates a new database: <code class="language-plaintext highlighter-rouge">CREATE DATABASE testDB</code>
</li>
</ul>

<h3 id="drop-database">
<a class="anchor" href="#drop-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>DROP DATABASE</h3>
<ul>
  <li>Drop an existing database: <code class="language-plaintext highlighter-rouge">DROP DATABASE testDB</code>
</li>
</ul>

<h3 id="backup-database">
<a class="anchor" href="#backup-database" aria-hidden="true"><span class="octicon octicon-link"></span></a>BACKUP DATABASE</h3>
<ul>
  <li>
    <p>Create full backup of existing database</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="n">BACKUP</span> <span class="k">DATABASE</span> <span class="n">testDB</span>
  <span class="k">TO</span> <span class="n">DISK</span> <span class="o">=</span> <span class="s1">'D:</span><span class="se">\b</span><span class="s1">ackups</span><span class="se">\l</span><span class="s1">atest_backup.bak'</span>
  <span class="k">WITH</span> <span class="n">DIFFERENTIAL</span> <span class="c1">-- include to only back up changes since last full backup</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="sql-table">
<a class="anchor" href="#sql-table" aria-hidden="true"><span class="octicon octicon-link"></span></a>SQL Table</h2>

<ul>
  <li>
    <p>Creating a table</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Create new table</span>
  <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">Users</span> <span class="p">(</span>
      <span class="n">id</span> <span class="nb">int</span><span class="p">,</span>
      <span class="n">name</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
      <span class="n">city</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span>
      <span class="n">age</span> <span class="nb">int</span><span class="p">,</span>
      <span class="n">is_loyal</span> <span class="nb">boolean</span>
  <span class="p">)</span>

  <span class="c1">-- Create new table from another table</span>
  <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">NYC_Users</span> <span class="k">AS</span>
  <span class="k">SELECT</span> <span class="n">id</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">city</span><span class="p">,</span> <span class="n">age</span>
  <span class="k">FROM</span> <span class="n">Users</span>
  <span class="k">WHERE</span> <span class="n">city</span> <span class="o">=</span> <span class="s1">'New York City'</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="sql-constraints">
<a class="anchor" href="#sql-constraints" aria-hidden="true"><span class="octicon octicon-link"></span></a>SQL Constraints</h3>
<ul>
  <li>Specifies rules for the data in the table</li>
</ul>

<table>
  <thead>
    <tr>
      <th>Constraint</th>
      <th>Function</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">NOT NULL</code></td>
      <td>column cannot have null values</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">UNIQUE</code></td>
      <td>column has all different values</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">PRIMARY KEY</code></td>
      <td>column is <code class="language-plaintext highlighter-rouge">NOT NULL</code> and <code class="language-plaintext highlighter-rouge">UNIQUE</code>, serves as row id</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">FOREIGN KEY</code></td>
      <td>prevents actions that would destroy links between tables</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">CHECK</code></td>
      <td>ensures column values specify a specific condition</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">DEFAULT</code></td>
      <td>set default value for column if no value specified</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">CREATE INDEX</code></td>
      <td>used to quickly create and retrieve data from database</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">AUTO_INCREMENT</code></td>
      <td>starting from 1, increments by 1 every time row inserted</td>
    </tr>
  </tbody>
</table>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>```sql
-- Create table with various constraints
CREATE TABLE Users (
    id int NOT NULL AUTO_INCREMENT,
    dept_id int NOT NULL,
    full_name varchar(255) NOT NULL,
    email varchar(255) UNIQUE,
    age int,
    city varchar(255) DEFAULT 'Seattle',
    CHECK (age &gt;= 18),
    PRIMARY KEY (id),
    FOREIGN KEY (dept_id)
)
```
</code></pre></div></div>

<ul>
  <li>
    <p>Alter or add, delete, modify columns or various constraints of a table</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Add column</span>
  <span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Users</span>
  <span class="k">ADD</span> <span class="n">email</span> <span class="nb">VARCHAR</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>

  <span class="c1">-- Drop column</span>
  <span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Users</span>
  <span class="k">DROP</span> <span class="k">column</span> <span class="n">is_loyal</span>

  <span class="c1">-- Change datatype</span>
  <span class="k">ALTER</span> <span class="k">TABLE</span> <span class="n">Users</span>
  <span class="k">MODIFY</span> <span class="k">COLUMN</span> <span class="n">city</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">300</span><span class="p">)</span>
</code></pre></div>    </div>
  </li>
  <li>
    <p>Remove a table</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Delete a table</span>
  <span class="k">DROP</span> <span class="k">TABLE</span> <span class="n">Users</span>

  <span class="c1">-- Truncate: delete data inside but not table itself</span>
  <span class="k">TRUNCATE</span> <span class="k">TABLE</span> <span class="n">Users</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="sql-index">
<a class="anchor" href="#sql-index" aria-hidden="true"><span class="octicon octicon-link"></span></a>SQL Index</h3>
<ul>
  <li>
    <p>An index is used to retrieve data more quickly, not seen by users</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Create index</span>
  <span class="k">CREATE</span> <span class="k">INDEX</span> <span class="n">idx_name</span>
  <span class="k">ON</span> <span class="n">Users</span> <span class="p">(</span><span class="n">last_name</span><span class="p">)</span>
    
  <span class="c1">-- Create unique index</span>
  <span class="k">CREATE</span> <span class="k">UNIQUE</span> <span class="k">INDEX</span> <span class="n">idx_name</span> 
  <span class="k">ON</span> <span class="n">Users</span> <span class="p">(</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last_name</span><span class="p">)</span>

  <span class="c1">-- Drop index</span>
  <span class="k">DROP</span> <span class="k">INDEX</span> <span class="n">idx_name</span> <span class="k">ON</span> <span class="n">Users</span>
</code></pre></div>    </div>
  </li>
</ul>

<h3 id="views">
<a class="anchor" href="#views" aria-hidden="true"><span class="octicon octicon-link"></span></a>Views</h3>
<ul>
  <li>
    <p>A virtual table based on the result-set of an SQL statement</p>

    <div class="language-sql highlighter-rouge">
<div class="highlight"><pre class="highlight"><code>  <span class="c1">-- Create the view</span>
  <span class="k">CREATE</span> <span class="k">VIEW</span> <span class="p">[</span><span class="n">Luxury</span> <span class="n">Products</span><span class="p">]</span> <span class="k">AS</span>
  <span class="k">SELECT</span> <span class="n">product_name</span><span class="p">,</span> <span class="n">price</span>
  <span class="k">FROM</span> <span class="n">products</span>
  <span class="k">WHERE</span> <span class="n">price</span> <span class="o">&gt;</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">products</span><span class="p">)</span>

  <span class="c1">-- Query the view</span>
  <span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="p">[</span><span class="n">Luxury</span> <span class="n">Products</span><span class="p">]</span>


  <span class="c1">-- Update the view</span>
  <span class="k">CREATE</span> <span class="k">OR</span> <span class="k">REPLACE</span> <span class="k">VIEW</span> <span class="p">[</span><span class="n">Luxury</span> <span class="n">Products</span><span class="p">]</span> <span class="k">AS</span>
  <span class="k">SELECT</span> <span class="n">product_name</span><span class="p">,</span> <span class="n">price</span>
  <span class="k">FROM</span> <span class="n">products</span>
  <span class="k">WHERE</span> <span class="n">price</span> <span class="o">&gt;</span> <span class="p">(</span><span class="k">SELECT</span> <span class="k">AVG</span><span class="p">(</span><span class="n">price</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">products</span><span class="p">)</span>

  <span class="c1">-- Drop the View</span>
  <span class="k">DROP</span> <span class="k">VIEW</span> <span class="p">[</span><span class="n">Luxury</span> <span class="n">Products</span><span class="p">]</span>
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="references">
<a class="anchor" href="#references" aria-hidden="true"><span class="octicon octicon-link"></span></a>References</h2>

  </div><a class="u-url" href="/notes/sql-overview" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/notes/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/notes/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/notes/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Notes and thoughts from a lifelong student.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/nhtsai" target="_blank" title="nhtsai"><svg class="svg-icon grey"><use xlink:href="/notes/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://www.linkedin.com/in/nhtsai" target="_blank" title="nhtsai"><svg class="svg-icon grey"><use xlink:href="/notes/assets/minima-social-icons.svg#linkedin"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
